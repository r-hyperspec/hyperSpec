<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to Package "hyperSpec" • hyperSpec</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Introduction to Package " hyperspec>
<meta property="og:description" content="Introduction: hyperSpec's main manual.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hyperSpec</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.200.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book"></span>
     
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Documentation for version of package:</li>
    <li>
      <a href="https://r-hyperspec.github.io/hyperSpec/" class="external-link">Released</a>
    </li>
    <li>
      <a href="https://r-hyperspec.github.io/hyperSpec/dev/" class="external-link">In-development</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/hyperSpec.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/fileio.html">Import and Export Files with Spectra</a>
    </li>
    <li>
      <a href="../articles/plotting.html">Plotting Functions in "hyperSpec"</a>
    </li>
    <li>
      <a href="../articles/baseline.html">Fitting Baselines to Spectra</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../articles/index.html">More articles...</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-hyperspec/hyperSpec/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to Package “hyperSpec”</h1>
            <h3 data-toc-skip class="subtitle">The Main Manual of Package “hyperSpec”</h3>
                        <h4 data-toc-skip class="author">Claudia Beleites<sup>1,2,3,4,5</sup>, Vilmantas Gegzna, Bryan A. Hanson</h4>
            <address class="author_afil">
      <ol style="list-style-type: decimal">
<li>DIA Raman Spectroscopy Group, University of Trieste/Italy (2005–2008)</li>
<li>Spectroscopy <span class="math inline">\(\cdot\)</span> Imaging, IPHT, Jena/Germany (2008–2017)</li>
<li>ÖPV, JKI, Berlin/Germany (2017–2019)</li>
<li>Arbeitskreis Lebensmittelmikrobiologie und Biotechnologie, Hamburg University, Hamburg/Germany (2019 – 2020)</li>
<li>Chemometric Consulting and Chemometrix GmbH, Wölfersheim/Germany (since 2016)</li>
</ol>
<br><a class="author_email" href="mailto:#"></a><a href="mailto:chemometrie@beleites.de" class="email">chemometrie@beleites.de</a>
      </address>
                  
            <h4 data-toc-skip class="date">2022-08-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/r-hyperspec/hyperSpec/blob/HEAD/vignettes/hyperSpec.Rmd" class="external-link"><code>vignettes/hyperSpec.Rmd</code></a></small>
      <div class="hidden name"><code>hyperSpec.Rmd</code></div>

    </div>

    
    
<!-- This chunk inserts common info about all the vignettes -->
<!-- ======================================================================= -->
<div class="note-t">
<p>
<strong>Note</strong>: <a name="list-of-vignettes"></a>
</p>
<p>
Package <strong><code>hyperSpec</code></strong> and it’s friends provide a number of vignettes to help you get started.
</p>
<ul>
<li>
<p>
You can access the vignettes via these links:
</p>
<ul>
<li>
<a href="http://r-hyperspec.github.io/hyperSpec/articles/hyperSpec.html" class="external-link">Introduction to <strong><code>hyperSpec</code></strong></a>
</li>
<li>
<a href="http://r-hyperspec.github.io/hyperSpec/articles/plotting.html" class="external-link">Plotting Functions in <strong><code>hyperSpec</code></strong></a>
</li>
<li>
<a href="http://r-hyperspec.github.io/hyperSpec/articles/baseline.html" class="external-link">Fitting Baselines to Spectra</a>
</li>
<li>
<a href="http://r-hyperspec.github.io/hyperSpec/articles/fileio.html" class="external-link">Importing Files into <strong><code>hyperSpec</code></strong></a>
</li>
<li>
<a href="http://r-hyperspec.github.io/hyperSpec/articles/flu.html" class="external-link">flu: Example Workflow for Fluorescene Emission</a>
</li>
<li>
<a href="http://r-hyperspec.github.io/hyperSpec/articles/laser.html" class="external-link">laser: Example Workflow for Spectral Time Series</a>
</li>
</ul>
</li>
<li>
<p>
Alternatively, if you are offline or prefer accessing the vignettes with <em>R</em>, simply type <code class="sourceCode r"><span class="fu">browseVignettes</span>(<span class="st">"hyperSpec"</span>)</code> to get a clickable list in a browser window.
</p>
</li>
<li>
<p>
Vignettes in other packages:
</p>
<ul>
<li>
<a href="https://r-hyperspec.github.io/hySpc.chondro/articles/hySpc-chondro.html" class="external-link">Example Workflow for 2D Raman Spectra</a> (<code>chondro</code> dataset)
</li>
<li>
<a href="https://r-hyperspec.github.io/hySpc.ggplot2/articles/hySpc-ggplot2.html" class="external-link">Plotting <code>hyperSpec</code> objects with <strong><code>ggplot2</code></strong></a>
</li>
<li>
<a href="https://r-hyperspec.github.io/hySpc.dplyr/articles/hySpc-dplyr.html" class="external-link">Using <strong><code>dplyr</code></strong> functions with <code>hyperSpec</code> objects</a>
</li>
</ul>
</li>
</ul>
</div>
<!-- ======================================================================= -->
<div class="section level2" number="1">
<h2 id="things-to-know-about-hyperspec">
<span class="header-section-number">1</span> Things to Know About <strong><em>hyperSpec</em></strong><a class="anchor" aria-label="anchor" href="#things-to-know-about-hyperspec"></a>
</h2>
<p>Package <strong>hyperSpec</strong> is a <code>R</code> package that allows convenient handling of  hyperspectral data sets, i.e., data sets combining spectra with further data on a per-spectrum basis.
The spectra can be anything that is recorded over a common discretized axis.
This vignette gives an introduction on basic working techniques using the <code>R</code> package package <strong>hyperSpec</strong>.
This is done mostly from a spectroscopic point of view: rather than going through the functions provided by package <strong>hyperSpec</strong>, it is organized by spectroscopic tasks.</p>
<div class="section level3" number="1.1">
<h3 id="terms-notations-used-here">
<span class="header-section-number">1.1</span> Terms &amp; Notations Used Here<a class="anchor" aria-label="anchor" href="#terms-notations-used-here"></a>
</h3>
<p>Throughout the documentation of the package, the following terms are used:</p>
<dl>
<dt>
<strong>wavelength</strong> </dt>
<dd>spectral abscissa
frequency, typical units are wavenumbers, chemical shift, Raman shift, <span class="math inline">\(\frac{m}{z}\)</span>, etc.
</dd>
<dt>
<strong>intensity</strong> </dt>
<dd>spectral ordinate
transmission, absorbance, <span class="math inline">\(\frac{e^{-}}{s}\)</span>, intensity, etc.
</dd>
<dt>
<strong>extra data</strong> </dt>
<dd>further information/data belonging to each spectrum such as
spatial information (spectral images, maps, or profiles), temporal information (kinetics, time series), concentrations (calibration series), class membership information, etc. Class <code>hyperSpec</code> object may contain arbitrary numbers of extra data columns.
</dd>
</dl>
<p>In R, slots of an S4 class are accessed by the <code class="sourceCode r"><span class="sc">@</span></code> operator.
In this vignette, the notation <code class="sourceCode r"><span class="sc">@</span>xxx</code> will thus mean <em>“slot xxx of an object”</em>.
Likewise, named elements of a <code>list</code> and columns of a <code>data.frame</code> are accessed by the  <code class="sourceCode r"><span class="sc">$</span></code> operator, and <code class="sourceCode r"><span class="sc">$</span>xxx</code> will be used for <em>“column xxx”</em>, and as an abbreviation for <em>“column xxx of the <code>data.frame</code> in slot data of the object”</em> (the structure of <code>hyperSpec</code> objects is discussed in section <a href="#sec:structure-chy">1.2</a>).</p>
</div>
<div class="section level3" number="1.2">
<h3 id="sec:structure-chy">
<span class="header-section-number">1.2</span> The Structure of <strong><em>hyperSpec</em></strong> Objects<a class="anchor" aria-label="anchor" href="#sec:structure-chy"></a>
</h3>
<p><code>hyperSpec</code> objects are defined using an S4 class. It contains the following slots:</p>
<ul>
<li>
<strong><code class="sourceCode r"><span class="sc">@</span>wavelength</code></strong> containing a numeric vector with the wavelength axis of the spectra.</li>
<li>
<strong><code class="sourceCode r"><span class="sc">@</span>data</code></strong> a <code>data.frame</code> with the spectra and all further information belonging to the spectra.</li>
<li>
<strong><code class="sourceCode r"><span class="sc">@</span>label</code></strong> a list with appropriate labels (particularly for axis annotations).</li>
</ul>
<p>Most of the data is stored in <code class="sourceCode r"><span class="sc">@</span>data</code>. This <code>data.frame</code> has one special column, <code class="sourceCode r"><span class="sc">$</span>spc</code>. This is the column that actually contains the spectra. The spectra are stored in a matrix inside this column, as illustrated in Figure <a href="#fig:structure">1.1</a>.
Even if there are no spectra, <code class="sourceCode r"><span class="sc">$</span>spc</code> must still be present.
It is then a matrix with zero columns.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:structure"></span>
<img src="intro--structure--hyperSpec--objects.png" alt="The structure of the data in a `hyperSpec` object.  In this example the 'extra data' are the `x`, `y` and `c` columns in `@data`." width="600"><p class="caption">
Figure 1.1: The structure of the data in a <code>hyperSpec</code> object. In this example the ‘extra data’ are the <code>x</code>, <code>y</code> and <code>c</code> columns in <code>@data</code>.
</p>
</div>
<p>Slot <code class="sourceCode r"><span class="sc">@</span>label</code> contains an element for each of the columns in <code class="sourceCode r"><span class="sc">@</span>data</code> plus one holding the label for the wavelength axis, <code>.wavelength</code>.
They are accessed by their names which must be the same for columns of <code class="sourceCode r"><span class="sc">@</span>data</code> and the list elements.
The elements of the list may be anything suitable for axis annotations, i.e., they should be either character strings or expressions for “pretty” axis annotations (see, e.g., Figure <a href="#fig:loess-kl">4.7</a>).
To get familiar with expressions for axis annotation, see <code><a href="https://rdrr.io/r/grDevices/plotmath.html" class="external-link">?plotmath</a></code> and <code class="sourceCode r"><span class="fu">demo</span>(plotmath)</code>.</p>
</div>
<div class="section level3" number="1.3">
<h3 id="data-sets">
<span class="header-section-number">1.3</span> Data Sets<a class="anchor" aria-label="anchor" href="#data-sets"></a>
</h3>
<p>Package <strong>hyperSpec</strong> comes with several data sets:</p>
<table class="table">
<colgroup>
<col width="21%">
<col width="78%">
</colgroup>
<tbody>
<tr class="odd">
<td align="left"><strong><code>flu</code></strong></td>
<td align="left">
A set of fluorescence spectra of a calibration series.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>laser</code></strong></td>
<td align="left">
A time series of an unstable laser emission.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>paracetamol</code></strong></td>
<td align="left">
A Raman spectrum of paracetamol (acetaminophen) ranging
from 100 to 3200 cm<sup>-1</sup> with overlapping wavelength ranges.</td>
</tr>
<tr class="even">
<td align="left"><strong><code>faux_cell</code></strong></td>
<td align="left">
A synthetic data set similar to
<a href="https://r-hyperspec.github.io/hySpc.chondro/" class="external-link"><code>chondro</code></a>.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code>barbiturates</code></strong></td>
<td align="left">
GC-MS spectra with differing wavelength axes as a list of
5 <strong>hyperSpec</strong> objects.</td>
</tr>
</tbody>
</table>
<p>In this vignette, the data sets are used to illustrate appropriate procedures for different tasks and different spectra.
In addition, <a href="#list-of-vignettes"><code>laser</code></a> and <a href="#list-of-vignettes"><code>flu</code></a> are accompanied by their own vignettes showing sample work flows for the respective data type.</p>
<p>This document describes how to accomplish typical tasks in the analysis of spectra.
It does not give a complete reference on particular functions.
It is therefore recommended to look up the methods in the <code>R</code> help system using <code class="sourceCode r">?command</code>.</p>
</div>
<div class="section level3" number="1.4">
<h3 id="options">
<span class="header-section-number">1.4</span> Options<a class="anchor" aria-label="anchor" href="#options"></a>
</h3>
<p>


The global behaviour of package <strong>hyperSpec</strong> can be configured via options.
The values of the options are retrieved with <code class="sourceCode r"><span class="fu">hy_get_options</span>()</code> and <code class="sourceCode r"><span class="fu">hy_get_option</span>()</code>, and changed with <code class="sourceCode r"><span class="fu">hy_set_options</span>()</code>.
Table <a href="#tab:options">8.1</a> gives an overview of the options. You should not worry about these at the start of your exploration of <strong>hyperSpec</strong>.</p>
</div>
</div>
<div class="section level2" number="2">
<h2 id="info-hyperspec-objs">
<span class="header-section-number">2</span> Obtaining Basic Information about <strong><em>hyperSpec</em></strong> Objects<a class="anchor" aria-label="anchor" href="#info-hyperspec-objs"></a>
</h2>
<p>Any of <code class="sourceCode r"><span class="fu">print</span>()</code>, <code class="sourceCode r"><span class="fu">show</span>()</code> or <code class="sourceCode r"><span class="fu">summary</span>()</code> provides an overview of the object (the output of each is identical):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">faux_cell</span></span>
<span><span class="co">#&gt; hyperSpec object</span></span>
<span><span class="co">#&gt;    875 spectra</span></span>
<span><span class="co">#&gt;    4 data columns</span></span>
<span><span class="co">#&gt;    300 data points / spectrum</span></span></code></pre></div>
<p>The data set <code class="sourceCode r">faux_cell</code> consists of 875 spectra with 300 data points each, and 4 data columns: two for the spatial information, one giving the cell region of each pixel plus <code class="sourceCode r"><span class="sc">$</span>spc</code>.
These details can be directly obtained by</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 875</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dim.html">nwl</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 300</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span></span>
<span><span class="co">#&gt; nrow ncol  nwl </span></span>
<span><span class="co">#&gt;  875    4  300</span></span></code></pre></div>
<p>The names of the columns in <code class="sourceCode r"><span class="sc">@</span>data</code> are accessed by <code class="sourceCode r"><span class="fu">colnames</span>()</code>.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/dimnames.html">colnames</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "x"      "y"      "region" "spc"</span></span></code></pre></div>
<p>Likewise, <code class="sourceCode r"><span class="fu">rownames</span>()</code> returns the names assigned to the spectra, and <code class="sourceCode r"><span class="fu">dimnames</span>()</code> yields a list of these three vectors (including also the column names of <code class="sourceCode r"><span class="sc">$</span>spc</code>).
The column names of the spectra matrix contain the wavelengths as a character vector, while <code class="sourceCode r"><span class="fu">wl</span>()</code> (see section <a href="#sec:wavel-axis-conv"><strong>??</strong></a>) returns the numeric vector of wavelengths.</p>
</div>
<div class="section level2" number="3">
<h2 id="sec:access-parts">
<span class="header-section-number">3</span> Accessing &amp; Manipulating <strong><em>hyperSpec</em></strong> Objects<a class="anchor" aria-label="anchor" href="#sec:access-parts"></a>
</h2>
<!-- If you edit the general description here or the getters/setters tables below, please make the corresponding changes in Extract.R where the same material is used to create the Rd files. Unfortunately the material is not formatted exactly the same in each place so you have to do more than simple cut and paste. -->
<p>While the parts of the <code>hyperSpec</code> object can be accessed directly, it is good practice to use the functions provided by the package to handle the objects rather than accessing the slots directly.
This also ensures that proper (i.e. <em>valid</em>) objects are returned.
In some cases, however, direct access to the slots can considerably speed up calculations (see the appendicies).</p>
<p>The main functions to retrieve the data of a <code>hyperSpec</code> object are <code>[]</code> and <code>[[]]</code>. 
The difference between these functions is that <code>[]</code> returns a <code>hyperSpec</code> object, whereas <code>[[]]</code> returns a <code>data.frame</code> containing <code class="sourceCode r">x<span class="sc">$</span>spc</code>, the spectral data.
To modify a <code>hyperSpec</code> object, the corresponding functions are <code class="sourceCode r">[<span class="ot">&lt;-</span></code> and <code class="sourceCode r">[[<span class="ot">&lt;-</span></code>. The first form is used to modify the entire <code>hyperSpec</code> object and the second form modifies the spectral data in <code class="sourceCode r">x<span class="sc">$</span>spc</code>.</p>
<p><strong>hyperSpec</strong> objects are triple indexed:</p>
<ul>
<li><code class="sourceCode r">x[i, j, l, wl.index <span class="ot">=</span> <span class="cn">TRUE</span><span class="sc">/</span><span class="cn">FALSE</span>]</code></li>
<li><code class="sourceCode r">x[[i, j, l, wl.ndex <span class="ot">=</span> <span class="cn">TRUE</span><span class="sc">/</span><span class="cn">FALSE</span>]]</code></li>
<li>
<code>i</code> refers to rows of the <code class="sourceCode r"><span class="sc">@</span>data</code> slot. <code>i</code> can be integer indices or a logical vector.</li>
<li>
<code>j</code> refers to columns of the <code class="sourceCode r"><span class="sc">@</span>data</code> slot. <code>j</code> can be integer indices, a logical vector or the name of a column. <em>However, there is no guaranteed order to</em> <code class="sourceCode r"><span class="fu">colnames</span>(x)</code> <em>so using integer indices and logical vectors is unwise.</em>
</li>
<li>
<code>l</code> refers to wavelengths. Note the argument <code>wl.index</code> which determines how <code>l</code> is interpreted.</li>
<li>If there is only one index given, e.g. <code class="sourceCode r">x[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</code>, it refers to the row index <code>i</code>. Likewise if there are only two indices given they refer to <code>i</code> and <code>j</code>.</li>
<li>See <a href="#sec:square-brack-replace"><strong>??</strong></a> and <a href="#sec:accessing-extra-data"><strong>??</strong></a> for even more ways to specify the indices.</li>
</ul>
<div class="section level3" number="3.1">
<h3 id="sec:getters">
<span class="header-section-number">3.1</span> Summary of Extraction Functions for <strong><em>hyperSpec</em></strong> Objects (getters)<a class="anchor" aria-label="anchor" href="#sec:getters"></a>
</h3>
<p>Table <a href="#tab:getters">3.1</a> shows the main functions that can be used with class <code>hyperSpec</code> to access the object (“getters”).</p>
<!-- ---------------------------------------------------------------------- -->
<table class="table">
<caption>
<strong><span id="tab:getters">Table 3.1: </span></strong> Getter functions for the slots of <code>hyperSpec</code> objects</caption>
<tbody>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x[]</code></strong></td>
<td align="left">Returns the entire <code>hyperSpec</code> object unchanged.</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">x[i, , ]</code></strong></td>
<td align="left">Returns the <code>hyperSpec</code> object with selected rows; equivalent to <code class="sourceCode r">x[i]</code>.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x[, j, ]</code></strong></td>
<td align="left">Returns the <code>hyperSpec</code> object with empty <code class="sourceCode r">x<span class="sc">$</span>spc</code> slot. If you want the column <code>j</code>, <code>x[["name"]]</code> returns a <code>data.frame</code> containing <code>j</code> or <code class="sourceCode r">x<span class="sc">$</span>name</code> returns it as a vector.</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">x[, , l, wl.index <span class="ot">=</span> <span class="cn">TRUE</span><span class="sc">/</span><span class="cn">FALSE</span>]</code></strong></td>
<td align="left">Returns the <code>hyperSpec</code> object with selected wavelengths.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x[[]]</code></strong></td>
<td align="left">Returns the spectra matrix (<code class="sourceCode r">x<span class="sc">$</span>spc</code>).</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">x[[i, , ]]</code></strong></td>
<td align="left">Returns the spectra matrix (<code class="sourceCode r">x<span class="sc">$</span>spc</code>) with selected rows.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x[[, j, ]]</code></strong></td>
<td align="left">Returns a <code class="sourceCode r">data.frame</code> with the selected columns. Safest to give <code>j</code> as a character string.</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">x[[, , l, wl.index <span class="ot">=</span> <span class="cn">TRUE</span><span class="sc">/</span><span class="cn">FALSE</span>]]</code></strong></td>
<td align="left">Returns the spectra matrix (<code class="sourceCode r">x<span class="sc">$</span>spc</code>) with selected wavelengths.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x<span class="sc">$</span>name</code></strong></td>
<td align="left">Returns the column <code>name</code> as a vector.</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r">x<span class="sc">$</span>.</code></strong></td>
<td align="left">Returns the complete <code class="sourceCode r">data.frame</code> <code class="sourceCode r">x<span class="sc">@</span>data</code>, with the spectra in column <code class="sourceCode r"><span class="sc">$</span>spc</code>.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r">x<span class="sc">$</span>..</code></strong></td>
<td align="left">Returns all the extra data (<code class="sourceCode r">x<span class="sc">@</span>data</code> without <code class="sourceCode r">x<span class="sc">$</span>spc</code>).</td>
</tr>
<tr class="even">
<td align="left"><strong><code class="sourceCode r"><span class="fu">wl</span>()</code></strong></td>
<td align="left">Returns the wavelengths.</td>
</tr>
<tr class="odd">
<td align="left"><strong><code class="sourceCode r"><span class="fu">labels</span>()</code></strong></td>
<td align="left">Returns the labels.</td>
</tr>
</tbody>
</table>
<!-- ---------------------------------------------------------------------- --><p>One can see that there are several ways to get the spectral data: <code class="sourceCode r">x<span class="sc">$</span>spc</code>, <code class="sourceCode r">x[[]]</code>, <code class="sourceCode r">x<span class="sc">$</span>..</code>.
The first two forms return a matrix, while the last returns a <code>data.frame</code>.</p>
</div>
<div class="section level3" number="3.2">
<h3 id="sec:setters">
<span class="header-section-number">3.2</span> Summary of Replacement Functions for <strong><em>hyperSpec</em></strong> Objects (setters)<a class="anchor" aria-label="anchor" href="#sec:setters"></a>
</h3>
<p>Table <a href="#tab:setters">3.2</a> shows the main functions that can be used with class <code>hyperSpec</code> to modify the object (“setters”).</p>
<!-- ---------------------------------------------------------------------- -->
<table class="table">
<caption>
<strong><span id="tab:setters">Table 3.2: </span></strong> Setter functions for the slots of <code>hyperSpec</code> objects</caption>
<colgroup>
<col width="28%">
<col width="71%">
</colgroup>
<thead><tr class="header">
<th align="left">
<strong><code class="sourceCode r">x[i, ,] <span class="ot">&lt;-</span></code></strong>
<strong><code class="sourceCode r">x[, j,] <span class="ot">&lt;-</span></code></strong>
<strong><code class="sourceCode r">x[i, j] <span class="ot">&lt;-</span></code></strong>
<strong><code class="sourceCode r">x[[i, ,]] <span class="ot">&lt;-</span></code></strong>
<strong><code class="sourceCode r">x[[, j,]] <span class="ot">&lt;-</span></code></strong>
<strong><code class="sourceCode r">x[[, , l, wl.index <span class="ot">=</span> <span class="cn">TRUE</span><span class="sc">/</span><span class="cn">FALSE</span>]] <span class="ot">&lt;-</span></code></strong>
<strong><code class="sourceCode r">x[[i, , l, wl.index <span class="ot">=</span> <span class="cn">TRUE</span><span class="sc">/</span><span class="cn">FALSE</span>]] <span class="ot">&lt;-</span></code></strong>
<strong><code class="sourceCode r">x<span class="sc">$</span>.. <span class="ot">&lt;-</span></code></strong>
<strong><code class="sourceCode r">wl<span class="ot">&lt;-</span></code></strong>
<strong><code class="sourceCode r">labels<span class="ot">&lt;-</span></code></strong>
</th>
<th align="left">Replaces the specified rows of the <code class="sourceCode r"><span class="sc">@</span>data</code> slot, including <code class="sourceCode r">x<span class="sc">$</span>spc</code> and any extra data columns. Other approaches are probably easier.
Replaces the specified columns. Safest to give <code>j</code> as a character string.
Replaces the specified column limited to the specified rows. Safest to give <code>j</code> as a character string.<strong><code class="sourceCode r">x[, , l, wl.index <span class="ot">=</span> <span class="cn">TRUE</span><span class="sc">/</span><span class="cn">FALSE</span>] <span class="ot">&lt;-</span></code></strong> Replaces the specified wavelengths.
Replaces the specified row of <code class="sourceCode r">x<span class="sc">$</span>spc</code>
As <code class="sourceCode r">[[]]</code> refers to just the spectral data in <code class="sourceCode r">x<span class="sc">$</span>spc</code>, this operation is not valid. See below.
Replaces the intensity values in <code class="sourceCode r">x<span class="sc">$</span>spc</code> for the specified wavelengths.
Replaces the intensity values in <code class="sourceCode r">x<span class="sc">$</span>spc</code> for the specified wavelengths limited to the specified rows.
Sets the extra data (<code class="sourceCode r">x<span class="sc">@</span>data</code> without touching <code class="sourceCode r">x<span class="sc">$</span>spc</code>). The column names must match exactly in this case.
Sets the wavelength vector.
Sets the labels.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">&lt;!– ——————————————-</td>
<td align="left">————————— –&gt;</td>
</tr>
<tr class="even">
<td align="left">
For more details on <code>[]&lt;-</code>, <code>[[]]&lt;-</code>, and <code>$&lt;-</code>,</td>
<td align="left">see <a href="#sec:square-brack-replace"><strong>??</strong></a> and <a href="#sec:accessing-extra-data"><strong>??</strong></a>.</td>
</tr>
<tr class="odd">
<td align="left">## Selecting and Deleting Spectra {#sec:select-d</td>
<td align="left">elete-spectra}</td>
</tr>
<tr class="even">
<td align="left">The extraction function <code>[]</code> takes the spectra (
It may be a vector giving the indices of the spe</td>
<td align="left">rows) as the first argument (For detailed help: see <code class="sourceCode r">?<span class="st">"["</span></code>).
ctra to extract (select), a vector with negative indices indicating, which spectra should be deleted, or a vector of logical values.</td>
</tr>
<tr class="odd">
<td align="left"><code>r data(palette_colorblind) # load colorblind-frien plot(flu, col = palette_colorblind[4]) plot(flu[1:3], add = TRUE)</code></td>
<td align="left">dly palette</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">docs/articles/hyperSpec_files/figure-html/selspc-1.png” alt=“An example with <code>[]</code> operator and positive indices.” /&gt;
<code>[]</code> operator and positive indices.</td>
</tr>
<tr class="odd">
<td align="left"><code>r plot(flu, col = palette_colorblind[4]) plot(flu[-3], add = TRUE)</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">docs/articles/hyperSpec_files/figure-html/delspc-1.png” alt=“An example with <code>[]</code> operator and negative indices.” /&gt;
<code>[]</code> operator and negative indices.</td>
</tr>
<tr class="odd">
<td align="left"><code>r plot(flu, col = palette_colorblind[4]) plot(flu[flu$c &gt; 0.2], add = TRUE)</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">docs/articles/hyperSpec_files/figure-html/selspc2-1.png” alt=“An example with <code>[]</code> operator and logical indices.” /&gt;
h <code>[]</code> operator and logical indices.</td>
</tr>
<tr class="odd">
<td align="left">### Random Samples {#sec:random-samples}</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">
A random subset of spectra can be conveniently s</td>
<td align="left">elected by <code class="sourceCode r"><span class="fu">sample</span>()</code>:</td>
</tr>
<tr class="odd">
<td align="left"><code>r sample(faux_cell, 3) #&gt; hyperSpec object #&gt;    3 spectra #&gt;    4 data columns #&gt;    300 data points / spectrum</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">
If indices into the selected spectra are needed</td>
<td align="left">instead, use <code class="sourceCode r"><span class="fu">sample</span>(..., <span class="at">index =</span> <span class="cn">TRUE</span>)</code>:</td>
</tr>
<tr class="odd">
<td align="left"><code>r sample(faux_cell, 3, index = TRUE) #&gt; [1] 183 797 279</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">### Sequences {#sec:seq}</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">
Sequences of every n<sup>th</sup> spectrum or the like ca</td>
<td align="left">n be retrieved with <code class="sourceCode r"><span class="fu">seq</span>()</code>:</td>
</tr>
<tr class="even">
<td align="left"><code>r seq(faux_cell, length.out = 3, index = TRUE) #&gt; [1]   1 438 875 seq(faux_cell, by = 100) #&gt; hyperSpec object #&gt;    9 spectra #&gt;    4 data columns #&gt;    300 data points / spectrum</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Here, indices may be requested using `index = TR</td>
<td align="left">UE`{.r}.</td>
</tr>
<tr class="even">
<td align="left">## Selecting Extra Data Columns {#sec:accessing</td>
<td align="left">-extra-data}</td>
</tr>
<tr class="odd">
<td align="left">The second argument of the extraction functions
They can be given like any column specification</td>
<td align="left">
<code>[]</code> and <code>[[]]</code> specifies the extra data columns.
for a <code class="sourceCode r">data.frame</code>, i.e., numeric, logical, or by a vector of the column names. However, since there is intrinsic order the column names of a <code>hyperSpec</code> object, using the column names is safest:</td>
</tr>
<tr class="even">
<td align="left"><code>r colnames(faux_cell) #&gt; [1] "x"      "y"      "region" "spc"</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><code>r faux_cell[[1:3, 1]] #&gt;        x #&gt; 1 -11.55 #&gt; 2 -10.55 #&gt; 3  -9.55</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>r faux_cell[[1:3, -5]] #&gt;        x     y region spc.602 spc.606 spc.610 #&gt; 1 -11.55 -4.77 matrix     132     132     150 #&gt; 2 -10.55 -4.77 matrix      72      73      99 #&gt; 3  -9.55 -4.77 matrix     120     132     142 #&gt;   spc.638 spc.642 spc.646 spc.650 spc.654 spc #&gt; 1     123     135     139     151     143 #&gt; 2      98      83      74      73      69 #&gt; 3     123     142     137     141     114 #&gt;   spc.686 spc.690 spc.694 spc.698 spc.702 spc #&gt; 1     145     134     127     136     121 #&gt; 2      80      93      76      80      79 #&gt; 3     128     137     118     115     116 #&gt;   spc.734 spc.738 spc.742 spc.746 spc.750 spc #&gt; 1     136     124     111     127     128 #&gt; 2      78      94      86      72      77 #&gt; 3     128     119     111     142     139 #&gt;   spc.782 spc.786 spc.790 spc.794 spc.798 spc #&gt; 1     159     232     267     288     324 #&gt; 2     129     160     193     237     260 #&gt; 3     172     216     267     282     313 #&gt;   spc.830 spc.834 spc.838 spc.842 spc.846 spc #&gt; 1     136     156     123     123     131 #&gt; 2      98      71      77      66      92 #&gt; 3     117     135     123     119     121 #&gt;   spc.878 spc.882 spc.886 spc.890 spc.894 spc #&gt; 1     132     120     123     117     111 #&gt; 2      85      82      85      74      81 #&gt; 3     117     144     126     143     148 #&gt;   spc.926 spc.930 spc.934 spc.938 spc.942 spc #&gt; 1     147     124     137     139     143 #&gt; 2      72      91      94      69      75 #&gt; 3     135     140     131     123     144 #&gt;   spc.974 spc.978 spc.982 spc.986 spc.990 spc #&gt; 1     141     138     132     145     122 #&gt; 2      86      84      78      80      97 #&gt; 3     146     139     135     134     131 #&gt;   spc.1018 spc.1022 spc.1026 spc.1030 spc.103 #&gt; 1      133      105      114      127      12 #&gt; 2       89       74       76       82       7 #&gt; 3      119      126      136      136      13 #&gt;   spc.1058 spc.1062 spc.1066 spc.1070 spc.107 #&gt; 1      130      136      143      116      14 #&gt; 2       84       83       95       66       9 #&gt; 3      126      130      135      133      12 #&gt;   spc.1098 spc.1102 spc.1106 spc.1110 spc.111 #&gt; 1      154      134      125      155      12 #&gt; 2       77       88       74       86       7 #&gt; 3      136      124      136      132      11 #&gt;   spc.1138 spc.1142 spc.1146 spc.1150 spc.115 #&gt; 1      130      123      122      131      15 #&gt; 2       96       72       75       86       8 #&gt; 3      147      137      144      126      12 #&gt;   spc.1178 spc.1182 spc.1186 spc.1190 spc.119 #&gt; 1      125      118      113      141      13 #&gt; 2       81       87       82       84       7 #&gt; 3      103      120      126      135      14 #&gt;   spc.1218 spc.1222 spc.1226 spc.1230 spc.123 #&gt; 1      152      117      126      126      15 #&gt; 2       74       80       71       88       7 #&gt; 3      132      135      151      137      13 #&gt;   spc.1258 spc.1262 spc.1266 spc.1270 spc.127 #&gt; 1      134      131      122      128      12 #&gt; 2       81       85       92       83       8 #&gt; 3      158      143      135      122      12 #&gt;   spc.1298 spc.1302 spc.1306 spc.1310 spc.131 #&gt; 1      120      125      111      132      14 #&gt; 2       73       78       91       79       9 #&gt; 3      140      140      128      134      13 #&gt;   spc.1338 spc.1342 spc.1346 spc.1350 spc.135 #&gt; 1      123      134      140      136      14 #&gt; 2       90      101       79       69       6 #&gt; 3      125      146      149      145      14 #&gt;   spc.1378 spc.1382 spc.1386 spc.1390 spc.139 #&gt; 1      115      154      127      123      12 #&gt; 2       77       82       92       92       8 #&gt; 3      133      136      151      133      16 #&gt;   spc.1418 spc.1422 spc.1426 spc.1430 spc.143 #&gt; 1      128      125      134      139      15 #&gt; 2       89       78      100       83       8 #&gt; 3      125      146      142      143      10 #&gt;   spc.1458 spc.1462 spc.1466 spc.1470 spc.147 #&gt; 1      142      130      143      121      12 #&gt; 2       72       95       85       93       8 #&gt; 3      133      149      144      132      14 #&gt;   spc.1498 spc.1502 spc.1506 spc.1510 spc.151 #&gt; 1      126      134      112      117      12 #&gt; 2       84       78       92       70       8 #&gt; 3      143      122      134      132      14 #&gt;   spc.1538 spc.1542 spc.1546 spc.1550 spc.155 #&gt; 1      143      116      134      123      13 #&gt; 2       84       85       76       86       9 #&gt; 3      160      127      143      149      14 #&gt;   spc.1578 spc.1582 spc.1586 spc.1590 spc.159 #&gt; 1      122      139      109      115      15 #&gt; 2       94       97       92       79       9 #&gt; 3      134      168      154      134      13 #&gt;   spc.1618 spc.1622 spc.1626 spc.1630 spc.163 #&gt; 1      134      132      132      115      12 #&gt; 2       90       79       94       84      10 #&gt; 3      149      147      148      138      16 #&gt;   spc.1658 spc.1662 spc.1666 spc.1670 spc.167 #&gt; 1      128      143      113      143      12 #&gt; 2       81       82      104       85       7 #&gt; 3      128      140      144      127      12 #&gt;   spc.1698 spc.1702 spc.1706 spc.1710 spc.171 #&gt; 1      151      125      159      130      13 #&gt; 2       65       75       93       95       9 #&gt; 3      124      147      133      143      14 #&gt;   spc.1738 spc.1742 spc.1746 spc.1750 spc.175 #&gt; 1      142      115      128      136      12 #&gt; 2       69       89       82       87       8 #&gt; 3      132      153      132      147      15 #&gt;   spc.1778 spc.1782 spc.1786 spc.1790 spc.179 #&gt; 1      136      133      139      123      11 #&gt; 2       66       83       75       87       9 #&gt; 3      144      147      143      120      14</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><code>r faux_cell[[1:3, "x"]] #&gt;        x #&gt; 1 -11.55 #&gt; 2 -10.55 #&gt; 3  -9.55</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>r faux_cell[[1:3, c(FALSE, TRUE)]] # note the recy #&gt;       y spc.602 spc.606 spc.610 spc.614 spc.6 #&gt; 1 -4.77     132     132     150     128     1 #&gt; 2 -4.77      72      73      99      84 #&gt; 3 -4.77     120     132     142     118     1 #&gt;   spc.646 spc.650 spc.654 spc.658 spc.662 spc #&gt; 1     139     151     143     133     113 #&gt; 2      74      73      69      90      84 #&gt; 3     137     141     114     127     120 #&gt;   spc.694 spc.698 spc.702 spc.706 spc.710 spc #&gt; 1     127     136     121     131     132 #&gt; 2      76      80      79      93      81 #&gt; 3     118     115     116     126     116 #&gt;   spc.742 spc.746 spc.750 spc.754 spc.758 spc #&gt; 1     111     127     128     152     133 #&gt; 2      86      72      77      76      79 #&gt; 3     111     142     139     123     111 #&gt;   spc.790 spc.794 spc.798 spc.802 spc.806 spc #&gt; 1     267     288     324     312     263 #&gt; 2     193     237     260     272     238 #&gt; 3     267     282     313     324     280 #&gt;   spc.838 spc.842 spc.846 spc.850 spc.854 spc #&gt; 1     123     123     131     131     134 #&gt; 2      77      66      92      64      84 #&gt; 3     123     119     121     125     134 #&gt;   spc.886 spc.890 spc.894 spc.898 spc.902 spc #&gt; 1     123     117     111     128     117 #&gt; 2      85      74      81      76      66 #&gt; 3     126     143     148     124     138 #&gt;   spc.934 spc.938 spc.942 spc.946 spc.950 spc #&gt; 1     137     139     143     128     123 #&gt; 2      94      69      75      81      72 #&gt; 3     131     123     144     126     118 #&gt;   spc.982 spc.986 spc.990 spc.994 spc.998 spc #&gt; 1     132     145     122     118     105 #&gt; 2      78      80      97      83      66 #&gt; 3     135     134     131     143     135 #&gt;   spc.1026 spc.1030 spc.1034 spc.1038 spc.104 #&gt; 1      114      127      129      142      13 #&gt; 2       76       82       79       96       8 #&gt; 3      136      136      138      113      12 #&gt;   spc.1066 spc.1070 spc.1074 spc.1078 spc.108 #&gt; 1      143      116      147      132      13 #&gt; 2       95       66       95       96       8 #&gt; 3      135      133      124      141      13 #&gt;   spc.1106 spc.1110 spc.1114 spc.1118 spc.112 #&gt; 1      125      155      123      111      13 #&gt; 2       74       86       76       70       8 #&gt; 3      136      132      116      148      14 #&gt;   spc.1146 spc.1150 spc.1154 spc.1158 spc.116 #&gt; 1      122      131      150      144      12 #&gt; 2       75       86       85       81       8 #&gt; 3      144      126      124      146      12 #&gt;   spc.1186 spc.1190 spc.1194 spc.1198 spc.120 #&gt; 1      113      141      131      117      12 #&gt; 2       82       84       77       80       6 #&gt; 3      126      135      147      138      12 #&gt;   spc.1226 spc.1230 spc.1234 spc.1238 spc.124 #&gt; 1      126      126      151      132      13 #&gt; 2       71       88       77       95       7 #&gt; 3      151      137      136      132      13 #&gt;   spc.1266 spc.1270 spc.1274 spc.1278 spc.128 #&gt; 1      122      128      128      153      13 #&gt; 2       92       83       88       79       8 #&gt; 3      135      122      129      127      12 #&gt;   spc.1306 spc.1310 spc.1314 spc.1318 spc.132 #&gt; 1      111      132      144      129      12 #&gt; 2       91       79       95       96       9 #&gt; 3      128      134      139      116      12 #&gt;   spc.1346 spc.1350 spc.1354 spc.1358 spc.136 #&gt; 1      140      136      141      131      14 #&gt; 2       79       69       63       83       8 #&gt; 3      149      145      145      129      13 #&gt;   spc.1386 spc.1390 spc.1394 spc.1398 spc.140 #&gt; 1      127      123      124      120      17 #&gt; 2       92       92       87       79       7 #&gt; 3      151      133      165      148      15 #&gt;   spc.1426 spc.1430 spc.1434 spc.1438 spc.144 #&gt; 1      134      139      157      130      14 #&gt; 2      100       83       80       91       8 #&gt; 3      142      143      101      149      13 #&gt;   spc.1466 spc.1470 spc.1474 spc.1478 spc.148 #&gt; 1      143      121      123      138      14 #&gt; 2       85       93       84      101       9 #&gt; 3      144      132      147      150      14 #&gt;   spc.1506 spc.1510 spc.1514 spc.1518 spc.152 #&gt; 1      112      117      120      145      14 #&gt; 2       92       70       80       82       7 #&gt; 3      134      132      149      121      15 #&gt;   spc.1546 spc.1550 spc.1554 spc.1558 spc.156 #&gt; 1      134      123      132      135      11 #&gt; 2       76       86       90       87       8 #&gt; 3      143      149      140      129      14 #&gt;   spc.1586 spc.1590 spc.1594 spc.1598 spc.160 #&gt; 1      109      115      154      118      12 #&gt; 2       92       79       90       72       8 #&gt; 3      154      134      134      153      13 #&gt;   spc.1626 spc.1630 spc.1634 spc.1638 spc.164 #&gt; 1      132      115      125      119      13 #&gt; 2       94       84      105       71       7 #&gt; 3      148      138      166      152      12 #&gt;   spc.1666 spc.1670 spc.1674 spc.1678 spc.168 #&gt; 1      113      143      128      126      12 #&gt; 2      104       85       76       98       7 #&gt; 3      144      127      124      131      14 #&gt;   spc.1706 spc.1710 spc.1714 spc.1718 spc.172 #&gt; 1      159      130      130      139      12 #&gt; 2       93       95       94       77       7 #&gt; 3      133      143      143      127      13 #&gt;   spc.1746 spc.1750 spc.1754 spc.1758 spc.176 #&gt; 1      128      136      123      124      12 #&gt; 2       82       87       88       78      10 #&gt; 3      132      147      155      154      14 #&gt;   spc.1786 spc.1790 spc.1794 spc.1798 #&gt; 1      139      123      119      129 #&gt; 2       75       87       92       90 #&gt; 3      143      120      149      154</code></td>
<td align="left">cling!
18 spc.622 spc.626 spc.630 spc.634 spc.638 spc.642
43 113 121 125 121 123 135
54 74 68 79 73 98 83
25 123 111 146 122 123 142
.666 spc.670 spc.674 spc.678 spc.682 spc.686 spc.690
124 104 127 127 131 145 134
80 69 61 65 76 80 93
137 115 127 137 142 128 137
.714 spc.718 spc.722 spc.726 spc.730 spc.734 spc.738
131 141 139 109 124 136 124
72 74 76 90 78 78 94
125 111 125 106 123 128 119
.762 spc.766 spc.770 spc.774 spc.778 spc.782 spc.786
122 166 132 146 136 159 232
91 69 63 84 109 129 160
138 119 109 126 111 172 216
.810 spc.814 spc.818 spc.822 spc.826 spc.830 spc.834
267 216 185 130 150 136 156
203 154 115 104 93 98 71
232 186 182 127 127 117 135
.858 spc.862 spc.866 spc.870 spc.874 spc.878 spc.882
128 133 151 143 124 132 120
80 75 79 81 77 85 82
130 125 136 125 135 117 144
.906 spc.910 spc.914 spc.918 spc.922 spc.926 spc.930
145 147 116 121 137 147 124
77 74 81 87 85 72 91
131 126 138 110 132 135 140
.954 spc.958 spc.962 spc.966 spc.970 spc.974 spc.978
113 120 139 162 108 141 138
84 82 80 70 80 86 84
135 138 144 142 116 146 139
.1002 spc.1006 spc.1010 spc.1014 spc.1018 spc.1022
116 132 122 137 133 105
67 78 90 77 89 74
128 131 139 128 119 126
2 spc.1046 spc.1050 spc.1054 spc.1058 spc.1062
9 122 114 122 130 136
3 72 69 86 84 83
6 150 115 133 126 130
2 spc.1086 spc.1090 spc.1094 spc.1098 spc.1102
8 137 108 130 154 134
7 90 80 85 77 88
5 131 128 141 136 124
2 spc.1126 spc.1130 spc.1134 spc.1138 spc.1142
2 146 146 122 130 123
5 71 71 94 96 72
4 145 147 124 147 137
2 spc.1166 spc.1170 spc.1174 spc.1178 spc.1182
9 132 133 130 125 118
7 75 72 82 81 87
1 155 139 150 103 120
2 spc.1206 spc.1210 spc.1214 spc.1218 spc.1222
9 136 120 124 152 117
0 87 81 89 74 80
4 127 128 124 132 135
2 spc.1246 spc.1250 spc.1254 spc.1258 spc.1262
4 138 127 117 134 131
5 78 76 79 81 85
5 138 136 109 158 143
2 spc.1286 spc.1290 spc.1294 spc.1298 spc.1302
1 116 143 127 120 125
8 90 81 87 73 78
8 135 134 123 140 140
2 spc.1326 spc.1330 spc.1334 spc.1338 spc.1342
4 128 124 121 123 134
0 69 87 82 90 101
3 145 128 134 125 146
2 spc.1366 spc.1370 spc.1374 spc.1378 spc.1382
9 117 131 134 115 154
4 73 85 78 77 82
2 116 126 123 133 136
2 spc.1406 spc.1410 spc.1414 spc.1418 spc.1422
0 130 138 139 128 125
7 80 89 75 89 78
0 111 133 133 125 146
2 spc.1446 spc.1450 spc.1454 spc.1458 spc.1462
6 131 128 137 142 130
4 98 82 95 72 95
0 139 135 143 133 149
2 spc.1486 spc.1490 spc.1494 spc.1498 spc.1502
8 131 132 125 126 134
4 95 90 73 84 78
5 130 122 116 143 122
2 spc.1526 spc.1530 spc.1534 spc.1538 spc.1542
8 134 131 121 143 116
8 87 87 105 84 85
8 143 123 143 160 127
2 spc.1566 spc.1570 spc.1574 spc.1578 spc.1582
7 130 129 118 122 139
6 86 95 69 94 97
5 137 149 138 134 168
2 spc.1606 spc.1610 spc.1614 spc.1618 spc.1622
4 131 123 148 134 132
2 81 79 90 90 79
2 148 129 152 149 147
2 spc.1646 spc.1650 spc.1654 spc.1658 spc.1662
0 129 128 118 128 143
4 88 83 74 81 82
2 144 124 150 128 140
2 spc.1686 spc.1690 spc.1694 spc.1698 spc.1702
1 126 134 126 151 125
9 85 108 86 65 75
3 142 135 134 124 147
2 spc.1726 spc.1730 spc.1734 spc.1738 spc.1742
7 129 122 138 142 115
3 82 83 85 69 89
9 141 169 137 132 153
2 spc.1766 spc.1770 spc.1774 spc.1778 spc.1782
2 122 129 128 136 133
3 79 92 85 66 83
7 143 138 131 144 147</td>
</tr>
<tr class="odd">
<td align="left">
To select one column, the <code class="sourceCode r"><span class="sc">$</span></code> operator is mo</td>
<td align="left">re convenient:</td>
</tr>
<tr class="even">
<td align="left"><code>r flu$c #&gt; [1] 0.05 0.10 0.15 0.20 0.25 0.30</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Class <code>hyperSpec</code> supports command line completi</td>
<td align="left">on for the <code class="sourceCode r"><span class="sc">$</span></code> operator.</td>
</tr>
<tr class="even">
<td align="left">
The extra data may also be set this way:</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><code>r flu$n &lt;- list(1:6, label = "sample no.")</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">This function will append new columns, if necess</td>
<td align="left">ary.</td>
</tr>
<tr class="odd">
<td align="left">## More on the <code>[[]]</code> and <code>[[]]&lt;-</code> {#double-squa</td>
<td align="left">re-brackets}</td>
</tr>
<tr class="even">
<td align="left">### Operators: Accessing Single Elements of the</td>
<td align="left">Spectra Matrix {#sec:square-brack-replace}</td>
</tr>
<tr class="odd">
<td align="left">Operator <code>[[]]</code> works mostly analogous to <code>[]</code>.
In addition, however, these two functions also a
In this case, a vector of values from the spectr</td>
<td align="left">ccept index matrices of size <span class="math inline">\(n × 2\)</span>.
a matrix is returned.</td>
</tr>
<tr class="even">
<td align="left"><code>r indexmatrix &lt;- matrix(c(1:3, 1:3), ncol = 2) indexmatrix #&gt;      [,1] [,2] #&gt; [1,]    1    1 #&gt; [2,]    2    2 #&gt; [3,]    3    3</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><code>r faux_cell[[indexmatrix, wl.index = TRUE]] #&gt; [1] 132  73 142</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>r diag(faux_cell[[1:3, , min ~ min + 2i]]) #&gt; [1] 132  73 142</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Operator <code>[[]]&lt;-</code> also accepts index matrices of</td>
<td align="left">size <span class="math inline">\(n × 2\)</span>.</td>
</tr>
<tr class="even">
<td align="left">## Wavelengths {#sec:wavelength-axis}</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">

\index{wavelength indices!conversion to waveleng</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">### Converting Wavelengths to Indices and Vice V</td>
<td align="left">ersa {#sec:wavelength-indices}</td>
</tr>
<tr class="odd">
<td align="left">
Spectra in package <strong>hyperSpec</strong> always have dis
Two functions are provided to convert the respec
For <code class="sourceCode r"><span class="fu">i2wl</span>()</code> you should provide a vector of
The basic syntax for the formula is **<code>start ~ e This yields a vector **</code>index_of_start : index_o</td>
<td align="left">crete wavelength axes, and are stored in a matrix with each column corresponding to one wavelength.
tive column indices into wavelengths and vice versa: <code class="sourceCode r"><span class="fu">i2wl</span>()</code> and <code class="sourceCode r"><span class="fu">wl2i</span>()</code>.
integers to serve as the indices. For <code class="sourceCode r"><span class="fu">wl2i</span>()</code> you can provide a vector of integers giving the wavelength range, or you can use a <em>formula</em> interface.
nd<code>**. f_end</code>**.</td>
</tr>
<tr class="even">
<td align="left">The result of the formula conversion differs fro</td>
<td align="left">m the integer vector conversion in three ways:</td>
</tr>
<tr class="odd">
<td align="left">- The colon operator for constructing vectors a
- If the vector does not take into account the</td>
<td align="left">ccepts only integer numbers, the tilde (for formulas) does not have this restriction.
spectral resolution, one may get only every <span class="math inline">\(n\)</span><sup>th</sup> point or repetitions of the same index:</td>
</tr>
<tr class="even">
<td align="left"><code>r wl2i(flu, 405:410) #&gt; [1]  1  3  5  7  9 11</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><code>r wl2i(flu, 405 ~ 410) #&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>r wl2i(faux_cell, 1000:1010) #&gt;  [1] 100 101 101 101 101 102 102 102 102 103</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><code>r wl2i(faux_cell, 1000 ~ 1010) #&gt; [1] 100 101 102 103</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">- If the object’s wavelength axis is not ordered
In that (probably rare) case, use <code><a href="../reference/wl_sort.html">wl_sort()</a></code>{</td>
<td align="left">, the formula approach will give weird results.
.r} first to obtain an object with ordered wavelength axis.</td>
</tr>
<tr class="odd">
<td align="left">Values <em>start</em> and <em>end</em> may contain the special
correspond to the lowest and highest wavelengths</td>
<td align="left">variables <code class="sourceCode r">min</code> and <code class="sourceCode r">max</code> that
of the object:</td>
</tr>
<tr class="even">
<td align="left"><code>r wl2i(flu, min ~ 410) #&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Often, specifications like *“wavelength <span class="math inline">\(pm n\)</span> d
They can be given using complex numbers in the f
The imaginary part is added to the index calcula</td>
<td align="left">ata points”* are needed.
ormula.
ted from the wavelength in the real part:</td>
</tr>
<tr class="even">
<td align="left"><code>r wl2i(flu, 450 - 2i ~ 450 + 2i) #&gt; [1] 89 90 91 92 93 wl2i(flu, max - 2i ~ max) #&gt; [1] 179 180 181</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">To specify several wavelength ranges, use a list</td>
<td align="left">containing the formulas and vectors<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>:</td>
</tr>
<tr class="even">
<td align="left"><code>r wl2i(flu, c(min ~ 406.5, max - 2i ~ max)) #&gt; [1]   1   2   3   4 179 180 181</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">This mechanism also works for the wavelength arg</td>
<td align="left">uments of <code>[]</code>, <code>[[]]</code>, and <code class="sourceCode r"><span class="fu">plot_spc</span>()</code>.</td>
</tr>
<tr class="even">
<td align="left">### Selecting Wavelength Ranges</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Wavelength ranges can easily be selected using `</td>
<td align="left">[]`’s third argument (Fig. <a href="#fig:paracetamol"><strong>??</strong></a>).</td>
</tr>
<tr class="even">
<td align="left"><code>r plot(paracetamol[, , 2800 ~ 3200])</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">docs/articles/hyperSpec_files/figure-html/paracetamol-1.png” alt=“Spectra of <code>paracetamol</code> in range of 2800–3200 cm<sup>-1</sup>.” /&gt;
<code>paracetamol</code> in range of 2800–3200 cm<sup>-1</sup>.</td>
</tr>
<tr class="even">
<td align="left">By default, the values given are treated as wave
If they are indices into the columns of the spec</td>
<td align="left">lengths.
tra matrix, use <code class="sourceCode r">wl.index <span class="ot">=</span> <span class="cn">TRUE</span></code>:</td>
</tr>
<tr class="odd">
<td align="left"><code>r plot(paracetamol[, , 2800:3200, wl.index = TRUE]</code></td>
<td align="left">)</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">docs/articles/hyperSpec_files/figure-html/unnamed-chunk-7-1.png” alt=“Spectra of <code>paracetamol</code>: from 2800<sup>th</sup> to 3200<sup>th</sup> point on <em>wavelength</em> axis.” /&gt;
a of <code>paracetamol</code>: from 2800<sup>th</sup> to 3200<sup>th</sup> point on <em>wavelength</em> axis.</td>
</tr>
<tr class="odd">
<td align="left">Section <a href="#sec:wavelength-indices"><strong>??</strong></a> delves int</td>
<td align="left">o the different possibilities of specifying wavelengths.</td>
</tr>
<tr class="even">
<td align="left">### Deleting Wavelength Ranges {#sec:del-wavelen</td>
<td align="left">gths}</td>
</tr>
<tr class="odd">
<td align="left">Deleting wavelength ranges may be accomplished u</td>
<td align="left">sing negative index vectors together with <code class="sourceCode r">wl.index <span class="ot">=</span> <span class="cn">TRUE</span></code>.</td>
</tr>
<tr class="even">
<td align="left"><code>r plot(paracetamol[, , -(500:1000), wl.index = TRU</code></td>
<td align="left">E])</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">docs/articles/hyperSpec_files/figure-html/unnamed-chunk-9-1.png” alt=“Spectra of <code>paracetamol</code> with 500<sup>th</sup> to 1000<sup>th</sup><em>wavelength</em> axis point removed.” /&gt;
a of <code>paracetamol</code> with 500<sup>th</sup> to 1000<sup>th</sup><em>wavelength</em> axis point removed.</td>
</tr>
<tr class="even">
<td align="left">However, this mechanism works only if the proper</td>
<td align="left">indices are known.</td>
</tr>
<tr class="odd">
<td align="left">If the range to be removed is instead specified
To delete the spectral range from 1750 to 2800 c</td>
<td align="left">in the units of the wavelength axis, it is easier to select the remainder of the spectrum instead.
m<sup>-1</sup> of the paracetamol spectrum one can use:</td>
</tr>
<tr class="even">
<td align="left"><code>r plot(paracetamol[, , c(min ~ 1750, 2800 ~ max)])</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">docs/articles/hyperSpec_files/figure-html/unnamed-chunk-11-1.png” alt=“Spectra of <code>paracetamol</code> with range from 1750 to 2800 cm<sup>-1</sup> removed.” /&gt;
ra of <code>paracetamol</code> with range from 1750 to 2800 cm<sup>-1</sup> removed.</td>
</tr>
<tr class="even">
<td align="left">It is possible to produce a plot of this data wh
For details see the <a href="#plotting-hyperspec">plotting</a>(#list-of-vignette</td>
<td align="left">ere the cut range is actually omitted and the wavelength axis is optionally cut in order to save space.
s) vignette.</td>
</tr>
<tr class="odd">
<td align="left">### Changing the Wavelength Axis {#sec:wavel-axi</td>
<td align="left">s-conv}</td>
</tr>
<tr class="even">
<td align="left">

Sometimes wavelength axes need to be transformed
In this case, retrieve the wavelength axis vecto
Also the label of the wavelength axis may need t</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">As an example, convert the wavelength axis of `l
As the wavelengths are in nanometers, and the fr</td>
<td align="left">aser`{.r} to frequencies.
equencies are easiest expressed in terahertz, an additional conversion factor of 1000 is needed:</td>
</tr>
<tr class="even">
<td align="left"><code>r laser #&gt; hyperSpec object #&gt;    84 spectra #&gt;    3 data columns #&gt;    36 data points / spectrum</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><code>r wavelengths &lt;- wl(laser) frequencies &lt;- 2.998e8 / wavelengths / 1000 wl(laser) &lt;- frequencies labels(laser, ".wavelength") &lt;- "f / THz" laser #&gt; hyperSpec object #&gt;    84 spectra #&gt;    3 data columns #&gt;    36 data points / spectrum rm(laser)</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">You can also accomplish these steps in a single</td>
<td align="left">line, e.g.,</td>
</tr>
<tr class="odd">
<td align="left">
<code>r wl(laser, "f / THz") &lt;- frequencies</code>
and</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">
<code>r wl(laser) &lt;- list(wl = frequencies, label = "f /</code>
see <code>?wl&lt;-</code> for more information.</td>
<td align="left">THz”)</td>
</tr>
<tr class="odd">
<td align="left">### Ordering the Wavelength Axis {#sec:wl-sort}</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">
If the wavelength axis of an object needs reorde</td>
<td align="left">ring (e.g., after <code class="sourceCode r"><span class="fu">collapse</span>()</code>), <code class="sourceCode r"><span class="fu">wl_sort</span>()</code> can be used:</td>
</tr>
<tr class="odd">
<td align="left"><code>r barb &lt;- collapse(barbiturates[1:3]) wl(barb) #&gt;  [1]  27.05  27.15  28.05  28.15  29.05  30.0 #&gt; [14]  43.05  43.85  43.95  44.05  55.00  55.1 #&gt; [27]  71.10  71.90  72.00  77.00  82.95  83.0 #&gt; [40] 106.00 112.90 113.00 116.95 117.95 118.0 #&gt; [53] 133.05 140.90 147.00 158.85 160.90</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>r barb &lt;- wl_sort(barb) wl(barb) #&gt;  [1]  27.05  27.15  28.05  28.15  29.05  30.0 #&gt; [14]  43.05  43.85  43.95  44.05  55.00  55.1 #&gt; [27]  71.10  71.90  72.00  77.00  82.95  83.0 #&gt; [40] 106.00 112.90 113.00 116.95 117.95 118.0 #&gt; [53] 133.05 140.90 147.00 158.85 160.90</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">## Conversion to Long- and Wide-Format `data.fra</td>
<td align="left">me`{.r}s {#sec:conv-long-form}</td>
</tr>
<tr class="even">
<td align="left">
Function <code class="sourceCode r"><span class="fu">as.data.frame</span>()</code> extracts the `<span class="citation">[<a href="#ref-da" role="doc-biblioref"><strong>da?</strong></a>]</span>
</td>
<td align="left">ta<code>{.r} slot as a</code>data.frame`{.r}:</td>
</tr>
<tr class="odd">
<td align="left"><code>r flu &lt;- flu[, , 400 ~ 407] # make a small and han as.data.frame(flu) #&gt;   spc.405 spc.405.5 spc.406 spc.406.5 spc.407 #&gt; 1  27.150    32.345  33.379    34.419  36.531 #&gt; 2  66.801    63.715  66.712    69.582  72.530 #&gt; 3  93.144   103.068 106.194   110.186 113.249 #&gt; 4 130.664   139.998 143.798   148.420 152.133 #&gt; 5 167.267   171.898 177.471   184.625 189.752 #&gt; 6 198.430   209.458 215.785   224.587 232.528</code></td>
<td align="left">dy version of the flu data set</td>
</tr>
<tr class="even">
<td align="left"><code>r colnames(as.data.frame(flu)) #&gt; [1] "spc"      "filename" "c"        "n"</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><code>r as.data.frame(flu)$spc #&gt;          405   405.5     406   406.5     407 #&gt; [1,]  27.150  32.345  33.379  34.419  36.531 #&gt; [2,]  66.801  63.715  66.712  69.582  72.530 #&gt; [3,]  93.144 103.068 106.194 110.186 113.249 #&gt; [4,] 130.664 139.998 143.798 148.420 152.133 #&gt; [5,] 167.267 171.898 177.471 184.625 189.752 #&gt; [6,] 198.430 209.458 215.785 224.587 232.528</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Note that the spectra matrix is still a matrix i</td>
<td align="left">nside column <code class="sourceCode r"><span class="sc">$</span>spc</code>.</td>
</tr>
<tr class="odd">
<td align="left">
Function <code class="sourceCode r"><span class="fu">as.data.frame</span>()</code> and the abbreviat</td>
<td align="left">ions <code class="sourceCode r"><span class="sc">$</span>.</code> and <code class="sourceCode r"><span class="sc">$</span>..</code> retrieve the usual wide format <code class="sourceCode r">data.frame</code>s:</td>
</tr>
<tr class="even">
<td align="left"><code>r flu$. #&gt;   spc.405 spc.405.5 spc.406 spc.406.5 spc.407 #&gt; 1  27.150    32.345  33.379    34.419  36.531 #&gt; 2  66.801    63.715  66.712    69.582  72.530 #&gt; 3  93.144   103.068 106.194   110.186 113.249 #&gt; 4 130.664   139.998 143.798   148.420 152.133 #&gt; 5 167.267   171.898 177.471   184.625 189.752 #&gt; 6 198.430   209.458 215.785   224.587 232.528</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"><code>r flu$.. #&gt;           filename    c n #&gt; 1 rawdata/flu1.txt 0.05 1 #&gt; 2 rawdata/flu2.txt 0.10 2 #&gt; 3 rawdata/flu3.txt 0.15 3 #&gt; 4 rawdata/flu4.txt 0.20 4 #&gt; 5 rawdata/flu5.txt 0.25 5 #&gt; 6 rawdata/flu6.txt 0.30 6</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">
If another subset of colums needs to be extracte</td>
<td align="left">d, use <code>[[]]</code>:</td>
</tr>
<tr class="odd">
<td align="left"><code>r flu[[, c("c", "spc")]] #&gt;      c spc.405 spc.405.5 spc.406 spc.406.5 sp #&gt; 1 0.05  27.150    32.345  33.379    34.419  3 #&gt; 2 0.10  66.801    63.715  66.712    69.582  7 #&gt; 3 0.15  93.144   103.068 106.194   110.186 11 #&gt; 4 0.20 130.664   139.998 143.798   148.420 15 #&gt; 5 0.25 167.267   171.898 177.471   184.625 18 #&gt; 6 0.30 198.430   209.458 215.785   224.587 23</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">This can be combined with extracting certain spe</td>
<td align="left">ctra and wavelengths, see <a href="#sec:conv-matrix"><strong>??</strong></a>.</td>
</tr>
<tr class="odd">
<td align="left">
The transpose of a wide format <code class="sourceCode r">data.frame</code>
For further examples, see the discussion of pack</td>
<td align="left">can be obtained by <code class="sourceCode r"><span class="fu">as.t.df</span>()</code>.
age <strong>ggplot2</strong> in the <a href="#list-of-vignettes">plotting</a> vignette.</td>
</tr>
<tr class="even">
<td align="left"><code>r as.t.df(apply(flu, 2, mean_pm_sd)) #&gt;           .wavelength mean.minus.sd   mean me #&gt; spc.405         405.0        49.958 113.91 #&gt; spc.405.5       405.5        53.396 120.08 #&gt; spc.406         406.0        55.352 123.89 #&gt; spc.406.5       406.5        57.310 128.64 #&gt; spc.407         407.0        59.513 132.79</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">
Some functions need the data in an <em>unstacked</em> o
Function <code class="sourceCode r"><span class="fu">as.long.df</span>()</code> is the appropriate c</td>
<td align="left">r <em>long-format</em> <code class="sourceCode r">data.frame</code>.
onversion function.</td>
</tr>
<tr class="even">
<td align="left"><code>r head(as.long.df(flu), 20) #&gt;     .wavelength     spc         filename    c #&gt; 1         405.0  27.150 rawdata/flu1.txt 0.05 #&gt; 2         405.0  66.801 rawdata/flu2.txt 0.10 #&gt; 3         405.0  93.144 rawdata/flu3.txt 0.15 #&gt; 4         405.0 130.664 rawdata/flu4.txt 0.20 #&gt; 5         405.0 167.267 rawdata/flu5.txt 0.25 #&gt; 6         405.0 198.430 rawdata/flu6.txt 0.30 #&gt; 1.1       405.5  32.345 rawdata/flu1.txt 0.05 #&gt; 2.1       405.5  63.715 rawdata/flu2.txt 0.10 #&gt; 3.1       405.5 103.068 rawdata/flu3.txt 0.15 #&gt; 4.1       405.5 139.998 rawdata/flu4.txt 0.20 #&gt; 5.1       405.5 171.898 rawdata/flu5.txt 0.25 #&gt; 6.1       405.5 209.458 rawdata/flu6.txt 0.30 #&gt; 1.2       406.0  33.379 rawdata/flu1.txt 0.05 #&gt; 2.2       406.0  66.712 rawdata/flu2.txt 0.10 #&gt; 3.2       406.0 106.194 rawdata/flu3.txt 0.15 #&gt; 4.2       406.0 143.798 rawdata/flu4.txt 0.20 #&gt; 5.2       406.0 177.471 rawdata/flu5.txt 0.25 #&gt; 6.2       406.0 215.785 rawdata/flu6.txt 0.30 #&gt; 1.3       406.5  34.419 rawdata/flu1.txt 0.05 #&gt; 2.3       406.5  69.582 rawdata/flu2.txt 0.10</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">## Conversion to Matrix {#sec:conv-matrix}</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">
To obtain the spectral data as a matrix, simply</td>
<td align="left">use the <code>[[]]</code> extractor:</td>
</tr>
<tr class="odd">
<td align="left"><code>r flu[[]] #&gt;          405   405.5     406   406.5     407 #&gt; [1,]  27.150  32.345  33.379  34.419  36.531 #&gt; [2,]  66.801  63.715  66.712  69.582  72.530 #&gt; [3,]  93.144 103.068 106.194 110.186 113.249 #&gt; [4,] 130.664 139.998 143.798 148.420 152.133 #&gt; [5,] 167.267 171.898 177.471 184.625 189.752 #&gt; [6,] 198.430 209.458 215.785 224.587 232.528</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left"><code>r class(flu[[]]) #&gt; [1] "matrix" "array"</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Operator <code>[[]]</code> takes the same arguments as <code>[]</code>
</td>
<td align="left">, and can be used to extract a matrix containing parts of the spectra matrix:</td>
</tr>
<tr class="even">
<td align="left"><code>r flu[[1:3, , 406 ~ 407]] #&gt;          406   406.5     407 #&gt; [1,]  33.379  34.419  36.531 #&gt; [2,]  66.712  69.582  72.530 #&gt; [3,] 106.194 110.186 113.249</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">If wavelengths or indices for the columns to ext</td>
<td align="left">ract are given, a <code class="sourceCode r">data.frame</code> is returned instead of a matrix:</td>
</tr>
<tr class="even">
<td align="left"><code>r flu[[1:3, c("filename", "spc"), 406 ~ 407]] #&gt;           filename spc.406 spc.406.5 spc.407 #&gt; 1 rawdata/flu1.txt  33.379    34.419  36.531 #&gt; 2 rawdata/flu2.txt  66.712    69.582  72.530 #&gt; 3 rawdata/flu3.txt 106.194   110.186 113.249</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left"># Creating a <strong><em>hyperSpec</em></strong> Object, Data Import</td>
<td align="left">and Export {#sec:create}</td>
</tr>
<tr class="even">
<td align="left">Package <strong>hyperSpec</strong> comes with filters for a v
These are discussed in detail in a separate [fil
Here we just mention a couple of basic operation</td>
<td align="left">ariety of file formats.
eio](#list-of-vignettes) vignette.
s.</td>
</tr>
<tr class="odd">
<td align="left">## Creating a <code>hyperSpec</code> Object from Spectra Ma</td>
<td align="left">trix and Wavelength Vector</td>
</tr>
<tr class="even">
<td align="left">If the data is in <code>R</code>’s workspace, a <code>hyperSpec</code>
</td>
<td align="left">object is created by:</td>
</tr>
<tr class="odd">
<td align="left"><code>r spc &lt;- new("hyperSpec", spc = spectra.matrix, wa</code></td>
<td align="left">velength = wavelength.vector, data = extra.data)</td>
</tr>
<tr class="even">
<td align="left">The most frequently needed arguments are:</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><strong><code>spc</code></strong> The spectra matrix; may be a matrix or a <code>data.frame</code>.</p>
<p><strong><code>wavelength</code></strong> The wavelength axis as a numeric vector.</p>
<p><strong><code>data</code></strong> Any extra data as a <code>data.frame</code>.
It is possible to pass <code>spc</code> via this argument if the data frame has a column
<code class="sourceCode r"><span class="sc">$</span>spc</code>.</p>
<p><strong><code>label</code></strong> A list with the proper labels.
Do not forget the wavelength axis label in <code class="sourceCode r"><span class="sc">$</span>.wavelength</code> and the spectral
intensity axis label in <code class="sourceCode r"><span class="sc">$</span>spc</code>.
—————- ———————————————————————————</p>
<p>More information about converting existing data into <code>hyperSpec</code> objects can be found in the <a href="#list-of-vignettes">fileio</a> vignette.</p>
</div>
<div class="section level3" number="3.3">
<h3 id="creating-random-spectra">
<span class="header-section-number">3.3</span> Creating Random Spectra<a class="anchor" aria-label="anchor" href="#creating-random-spectra"></a>
</h3>
<p>If package <strong>mvtnorm</strong><span class="citation">[<a href="#ref-R-mvtnorm" role="doc-biblioref">1</a>,<a href="#ref-mvtnorm2009" role="doc-biblioref">2</a>]</span> is available, multivariate normally distributed spectra can be generated from mean and covariance matrix using <code class="sourceCode r"><span class="fu">rmmvnorm</span>()</code> (Fig. <a href="#fig:sim-spc">3.1</a>).
Note that the package <strong>hyperSpec</strong> function’s name has an additional “m”: it already takes care of multiple groups.
Mean spectra and pooled covariance matrix can be calculated using <code class="sourceCode r"><span class="fu">cov_pooled</span>()</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pcov</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cov.html">cov_pooled</a></span><span class="op">(</span><span class="va">faux_cell</span>, <span class="va">faux_cell</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span>
<span><span class="va">rnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rmmvnorm.html">rmmvnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">3</span><span class="op">)</span>, mean <span class="op">=</span> <span class="va">pcov</span><span class="op">$</span><span class="va">mean</span>, sigma <span class="op">=</span> <span class="va">pcov</span><span class="op">$</span><span class="va">COV</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cluster.cols</span> <span class="op">&lt;-</span> <span class="va">palette_colorblind</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">7</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">rnd</span>, col <span class="op">=</span> <span class="va">cluster.cols</span><span class="op">[</span><span class="va">rnd</span><span class="op">$</span><span class="va">.group</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:sim-spc"></span>
<img src="hyperSpec_files/figure-html/sim-spc-1.png" alt="Multivariate normally distributed random spectra generated with `rmmvnorm()`{.r}."><p class="caption">
Figure 3.1: Multivariate normally distributed random spectra generated with <code class="sourceCode r"><span class="fu">rmmvnorm</span>()</code>.
</p>
</div>
</div>
</div>
<div class="section level2" number="4">
<h2 id="spectral-pre-processing">
<span class="header-section-number">4</span> Spectral Pre-Processing<a class="anchor" aria-label="anchor" href="#spectral-pre-processing"></a>
</h2>
<div class="section level3" number="4.1">
<h3 id="cutting-the-spectral-range">
<span class="header-section-number">4.1</span> Cutting the Spectral Range<a class="anchor" aria-label="anchor" href="#cutting-the-spectral-range"></a>
</h3>
<p>Please refer to Table <a href="#tab:getters">3.1</a>, Table <a href="#tab:setters">3.2</a> and Section <a href="#sec:wavelength-axis"><strong>??</strong></a> for information and examples of cutting the spectral range.</p>
</div>
<div class="section level3" number="4.2">
<h3 id="sec:shifting-spectra">
<span class="header-section-number">4.2</span> Shifting Spectra<a class="anchor" aria-label="anchor" href="#sec:shifting-spectra"></a>
</h3>
<p>Sometimes, spectra need to be aligned along the spectral axis.</p>
<p>In general, two options are available for shifting spectra along the wavelength axis.</p>
<ol style="list-style-type: decimal">
<li>The wavelength axis can be shifted, while the intensities stay unaffected.</li>
<li>The spectra are interpolated onto a new wavelength axis, while the nominal wavelengths stay.</li>
</ol>
<p>The first method is very straightforward (Fig. <a href="#fig:shift-wl">4.1</a>):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span></span>
<span><span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span> <span class="op">-</span> <span class="fl">10</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[</span><span class="fl">135</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span><span class="fl">135</span>, , <span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="va">palette_colorblind</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:shift-wl"></span>
<img src="hyperSpec_files/figure-html/shift-wl-1.png" alt="Shifting the spectra along the wavelength axis: changing the wavelength values.  "><p class="caption">
Figure 4.1: Shifting the spectra along the wavelength axis: changing the wavelength values.
</p>
</div>
<p>But the method cannot be used if each spectrum (or groups of spectra) are shifted individually.
In that case, interpolation is needed.
<code>R</code> offers many possibilities to interpolate (e.g., <code class="sourceCode r"><span class="fu">approx</span>()</code> for constant / linear approximation, <code class="sourceCode r"><span class="fu">spline</span>()</code> for spline interpolation, <code class="sourceCode r"><span class="fu">loess</span>()</code> can be used to obtain smoothed approximations, etc.).
The appropriate interpolation strategy will depend on the spectra, and package <strong>hyperSpec</strong> therefore leaves it up to the user to select a sensible interpolation function.</p>
<p>As an example, we will use natural splines to do the interpolation.
It is convenient to set it up as a function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interpolate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">spc</span>, <span class="va">shift</span>, <span class="va">wl</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/splinefun.html" class="external-link">spline</a></span><span class="op">(</span><span class="va">wl</span> <span class="op">+</span> <span class="va">shift</span>, <span class="va">spc</span>, xout <span class="op">=</span> <span class="va">wl</span>, method <span class="op">=</span> <span class="st">"natural"</span><span class="op">)</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>This function can now be applied to a set of spectra (Fig. <a href="#fig:shift-interp">4.2</a>):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span><span class="op">(</span><span class="va">faux_cell</span>, <span class="fl">1</span>, <span class="va">interpolate</span>, shift <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>, wl <span class="op">=</span> <span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[</span><span class="fl">135</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span><span class="fl">135</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="va">palette_colorblind</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:shift-interp"></span>
<img src="hyperSpec_files/figure-html/shift-interp-1.png" alt="Shifting the spectra along the wavelength axis: interpolation.  "><p class="caption">
Figure 4.2: Shifting the spectra along the wavelength axis: interpolation.
</p>
</div>
<p>Fig. <a href="#fig:shift-untsch">4.3</a> demonstrates the difference between simple shifting and interpolation.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span><span class="op">[</span><span class="fl">135</span>, , <span class="fl">990</span> <span class="op">~</span> <span class="fl">1010</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">tmp</span>, lines.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.5</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">tmp</span>, lines.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="va">palette_colorblind</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span><span class="op">[</span><span class="fl">135</span><span class="op">]</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span><span class="op">(</span><span class="va">tmp</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">wl</span>, <span class="va">shift</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/splinefun.html" class="external-link">spline</a></span><span class="op">(</span><span class="va">wl</span> <span class="op">+</span> <span class="va">shift</span>, <span class="va">x</span>, xout <span class="op">=</span> <span class="va">wl</span><span class="op">)</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="op">}</span>,</span>
<span>wl <span class="op">=</span> <span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span>, shift <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">tmp</span>, lines.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="va">palette_colorblind</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:shift-untsch"></span>
<img src="hyperSpec_files/figure-html/shift-untsch-1.png" alt="Shifting the spectra along the wavelength axis.
Detail view of the phenylalanine band: shifting by `wl&lt;-`{.r} (red) does not affect the intensities, while the spectrum is slightly changed by interpolations (blue).  "><p class="caption">
Figure 4.3: Shifting the spectra along the wavelength axis.
Detail view of the phenylalanine band: shifting by <code class="sourceCode r">wl<span class="ot">&lt;-</span></code> (red) does not affect the intensities, while the spectrum is slightly changed by interpolations (blue).
</p>
</div>
<p>If different spectra need to be offset by different shift, use a loop<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shifts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tmp</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">interpolate</span><span class="op">(</span><span class="va">tmp</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>, <span class="va">shifts</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, wl <span class="op">=</span> <span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">faux_cell</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tmp</span></span></code></pre></div>
<div class="section level4" number="4.2.1">
<h4 id="sec:calculating-shift">
<span class="header-section-number">4.2.1</span> Calculating the Shift<a class="anchor" aria-label="anchor" href="#sec:calculating-shift"></a>
</h4>
<p>Often, the shift in the spectra is determined by aligning a particular signal.
This strategy works best with spectrally oversampled data that allows accurate determination of the signal position.</p>
<p>For the <code class="sourceCode r">faux_cell</code> data, let’s use the maximum of the peak around 1200 cm<sup>-1</sup>.
As just the very maximum is too coarse, we’ll use the maximum of a square polynomial fitted to the maximum and its two neighbours.</p>
<!-- ======================================================================= -->
<!-- ======================================================================= -->
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># FIXME: this code currently does not work.</span></span>
<span><span class="va">find_max</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">pos</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span> <span class="op">-</span> <span class="va">x</span><span class="op">[</span><span class="va">pos</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="va">pos</span><span class="op">]</span> <span class="op">-</span> <span class="va">y</span><span class="op">[</span><span class="va">pos</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">X</span>, <span class="va">X</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/qr.html" class="external-link">qr.solve</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">-</span><span class="va">coef</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="va">coef</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">/</span> <span class="fl">2</span> <span class="op">+</span> <span class="va">x</span><span class="op">[</span><span class="va">pos</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">bandpos</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[[</span>, , <span class="fl">1190</span> <span class="op">~</span> <span class="fl">1210</span><span class="op">]</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">find_max</span>, <span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[</span>, , <span class="fl">1190</span> <span class="op">~</span> <span class="fl">1210</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">refpos</span> <span class="op">&lt;-</span> <span class="fu">find_max</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[[</span>, , <span class="fl">1190</span> <span class="op">~</span> <span class="fl">1210</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[</span>, , <span class="fl">1190</span> <span class="op">~</span> <span class="fl">1210</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">shift1</span> <span class="op">&lt;-</span> <span class="va">refpos</span> <span class="op">-</span> <span class="va">bandpos</span></span></code></pre></div>
<p>A second possibility is to optimize the shift.
For this strategy, the spectra must be sufficiently similar, while low spectral resolution is compensated by using larger spectral windows.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">faux_cell_tmp</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span> <span class="op">-</span> <span class="fu"><a href="../reference/baselines.html">spc_fit_poly_below</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[</span>, , <span class="va">min</span> <span class="op">+</span> <span class="fl">3i</span> <span class="op">~</span> <span class="va">max</span> <span class="op">-</span> <span class="fl">3i</span><span class="op">]</span>, <span class="va">faux_cell</span><span class="op">)</span></span>
<span><span class="va">faux_cell_tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sweep.html">sweep</a></span><span class="op">(</span><span class="va">faux_cell_tmp</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="st">"/"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">targetfn</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">shift</span>, <span class="va">wl</span>, <span class="va">spc</span>, <span class="va">targetspc</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/splinefun.html" class="external-link">spline</a></span><span class="op">(</span><span class="va">wl</span> <span class="op">+</span> <span class="va">shift</span>, <span class="va">spc</span>, xout <span class="op">=</span> <span class="va">wl</span><span class="op">)</span><span class="op">$</span><span class="va">y</span> <span class="op">-</span> <span class="va">targetspc</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">error</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">shift2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">shift2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/optimize.html" class="external-link">optimize</a></span><span class="op">(</span><span class="va">targetfn</span>,</span>
<span>    interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    wl <span class="op">=</span> <span class="va">faux_cell</span><span class="op">@</span><span class="va">wavelength</span>,</span>
<span>    spc <span class="op">=</span> <span class="va">tmp</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>, targetspc <span class="op">=</span> <span class="va">target</span></span>
<span>  <span class="op">)</span><span class="op">$</span><span class="va">minimum</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Figure <a href="#fig:fit-shift"><strong>??</strong></a> shows that the second correction method works better for the <code>faux_cell</code> data.
This was expected, as the spectra are hardly or not oversampled, but are very similar to each other.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># FIXME: this code currently does not work.</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  shift <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">shifts</span>, <span class="va">shifts</span> <span class="op">+</span> <span class="va">shift1</span>, <span class="va">shifts</span> <span class="op">+</span> <span class="va">shift2</span><span class="op">)</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"original"</span>, <span class="st">"find maximum"</span>, <span class="st">"interpolation"</span><span class="op">)</span>,</span>
<span>    each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/histogram.html" class="external-link">histogram</a></span><span class="op">(</span><span class="op">~</span> <span class="va">shift</span> <span class="op">|</span> <span class="va">method</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/histogram.html" class="external-link">do.breaks</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">shift</span><span class="op">)</span>, <span class="fl">25</span><span class="op">)</span>,</span>
<span>  layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3" number="4.3">
<h3 id="removing-bad-data">
<span class="header-section-number">4.3</span> Removing Bad Data<a class="anchor" aria-label="anchor" href="#removing-bad-data"></a>
</h3>
<div class="section level4" number="4.3.1">
<h4 id="sec:bad-spectra">
<span class="header-section-number">4.3.1</span> Bad Spectra<a class="anchor" aria-label="anchor" href="#sec:bad-spectra"></a>
</h4>
<p>Occasionally, one may want to remove spectra because of too low or too high signal.
E.g., for infrared spectra one may state that the absorbance maximum should be, say, between 0.1 and 1.
Class <code>hyperSpec</code>’s comparison operators return a logical matrix of the size of the spectra that is suitable for later indexing:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ir_spc</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span> <span class="op">/</span> <span class="fl">1500</span> <span class="co">## fake IR data</span></span>
<span><span class="va">high_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span><span class="op">(</span><span class="va">ir_spc</span> <span class="op">&gt;</span> <span class="fl">1</span>, <span class="fl">1</span>, <span class="va">any</span><span class="op">)</span> <span class="co"># any point above 1 is bad</span></span>
<span><span class="va">low_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span><span class="op">(</span><span class="va">ir_spc</span>, <span class="fl">1</span>, <span class="va">max</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.1</span> <span class="co"># the maximum should be at least 0.1</span></span>
<span><span class="va">ir_spc</span> <span class="op">&lt;-</span> <span class="va">ir_spc</span><span class="op">[</span><span class="op">!</span><span class="va">high_int</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">low_int</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level4" number="4.3.2">
<h4 id="removing-spectra-outside-mean-pm-n-standard-deviations">
<span class="header-section-number">4.3.2</span> Removing Spectra Outside Mean <span class="math inline">\(\pm\)</span> <span class="math inline">\(n\)</span> Standard Deviations<a class="anchor" aria-label="anchor" href="#removing-spectra-outside-mean-pm-n-standard-deviations"></a>
</h4>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean_sd_filter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="va">n</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">(</span><span class="va">x</span> <span class="op">&lt;=</span> <span class="va">s</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="op">-</span><span class="va">s</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">OK</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">mean_sd_filter</span>, n <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="co"># logical matrix</span></span>
<span></span>
<span><span class="va">spc.OK</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span><span class="op">[</span><span class="fu"><a href="../reference/apply.html">apply</a></span><span class="op">(</span><span class="va">OK</span>, <span class="fl">1</span>, <span class="va">all</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="../reference/apply.html">apply</a></span><span class="op">(</span><span class="va">OK</span>, <span class="fl">1</span>, <span class="va">all</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="op">!</span><span class="va">OK</span>, arr.ind <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="va">faux_cell</span><span class="op">[[</span><span class="op">!</span><span class="va">OK</span><span class="op">]</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span>, col <span class="op">=</span> <span class="va">palette_colorblind</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:filter"></span>
<img src="hyperSpec_files/figure-html/filter-1.png" alt="Filtering data: mean $\pm$ sd filter.  "><p class="caption">
Figure 4.4: Filtering data: mean <span class="math inline">\(\pm\)</span> sd filter.
</p>
</div>
</div>
<div class="section level4" number="4.3.3">
<h4 id="sec:bad-data-points">
<span class="header-section-number">4.3.3</span> Bad Data Points<a class="anchor" aria-label="anchor" href="#sec:bad-data-points"></a>
</h4>
<p>Assume the data occasionally has a detector readout of 0:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spc</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, , <span class="va">min</span> <span class="op">~</span> <span class="va">min</span> <span class="op">+</span> <span class="fl">15i</span><span class="op">]</span></span>
<span><span class="va">spc</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="../reference/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="../reference/dim.html">nwl</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, wl.index <span class="op">=</span> <span class="cn">TRUE</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">spc</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;         602     606     610     614    618     622     626    630     634     638     642     646</span></span>
<span><span class="co">#&gt; [1,] 138.13 129.659 138.745 144.504 131.23 136.949 111.078 124.11 123.946   0.000 126.461 136.325</span></span>
<span><span class="co">#&gt; [2,]   0.00  73.371  99.227  83.301  54.00  74.184  68.029  79.00  73.236  98.166  82.623  73.986</span></span>
<span><span class="co">#&gt; [3,] 120.10 132.189   0.000 117.864 125.13 122.796 111.221 146.10 121.732 123.221 142.052 137.024</span></span>
<span><span class="co">#&gt;          650     654     658     662</span></span>
<span><span class="co">#&gt; [1,] 142.723 150.316 140.794 125.848</span></span>
<span><span class="co">#&gt; [2,]  72.874  69.232  90.187  83.842</span></span>
<span><span class="co">#&gt; [3,] 140.820 113.921 127.047 120.082</span></span></code></pre></div>
<p>We can set these points to <code class="sourceCode r"><span class="cn">NA</span></code>, again using that the comparison returns a suitable logical matrix:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spc</span><span class="op">[[</span><span class="va">spc</span> <span class="op">&lt;</span> <span class="fl">1e-4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">spc</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;         602     606     610     614    618     622     626    630     634     638     642     646</span></span>
<span><span class="co">#&gt; [1,] 138.13 129.659 138.745 144.504 131.23 136.949 111.078 124.11 123.946      NA 126.461 136.325</span></span>
<span><span class="co">#&gt; [2,]     NA  73.371  99.227  83.301  54.00  74.184  68.029  79.00  73.236  98.166  82.623  73.986</span></span>
<span><span class="co">#&gt; [3,] 120.10 132.189      NA 117.864 125.13 122.796 111.221 146.10 121.732 123.221 142.052 137.024</span></span>
<span><span class="co">#&gt;          650     654     658     662</span></span>
<span><span class="co">#&gt; [1,] 142.723 150.316 140.794 125.848</span></span>
<span><span class="co">#&gt; [2,]  72.874  69.232  90.187  83.842</span></span>
<span><span class="co">#&gt; [3,] 140.820 113.921 127.047 120.082</span></span></code></pre></div>
<p>Depending on the type of analysis, one may wish to replace the <code class="sourceCode r"><span class="cn">NA</span></code>s by interpolating the neighbour values.
Package <strong>hyperSpec</strong> provides three functions that can interpolate the <code class="sourceCode r"><span class="cn">NA</span></code>s: <code class="sourceCode r"><span class="fu">spc_na_approx</span>()</code>, <code class="sourceCode r"><span class="fu">spc_loess</span>()</code>, and <code class="sourceCode r"><span class="fu">spc_bin</span>()</code> with <code class="sourceCode r">na.rm <span class="ot">=</span> <span class="cn">TRUE</span></code> (the latter two are discussed below).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spc.corrected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spc_na_approx.html">spc_na_approx</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span></span>
<span><span class="va">spc.corrected</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;          602     606     610     614    618     622     626    630     634     638     642     646</span></span>
<span><span class="co">#&gt; [1,] 138.127 129.659 138.745 144.504 131.23 136.949 111.078 124.11 123.946 125.204 126.461 136.325</span></span>
<span><span class="co">#&gt; [2,]  73.371  73.371  99.227  83.301  54.00  74.184  68.029  79.00  73.236  98.166  82.623  73.986</span></span>
<span><span class="co">#&gt; [3,] 120.105 132.189 125.026 117.864 125.13 122.796 111.221 146.10 121.732 123.221 142.052 137.024</span></span>
<span><span class="co">#&gt;          650     654     658     662</span></span>
<span><span class="co">#&gt; [1,] 142.723 150.316 140.794 125.848</span></span>
<span><span class="co">#&gt; [2,]  72.874  69.232  90.187  83.842</span></span>
<span><span class="co">#&gt; [3,] 140.820 113.921 127.047 120.082</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spc</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span></span>
<span></span>
<span><span class="va">spc</span><span class="op">[[</span><span class="va">spc</span> <span class="op">&lt;</span> <span class="fl">1e-4</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/spc_na_approx.html">spc_na_approx</a></span><span class="op">(</span><span class="va">spc</span><span class="op">)</span>,</span>
<span>  add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="va">palette_colorblind</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>,</span>
<span>  lines.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"b"</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:bad"></span>
<img src="hyperSpec_files/figure-html/bad-1.png" alt="Filtering data: remove bad points.  "><p class="caption">
Figure 4.5: Filtering data: remove bad points.
</p>
</div>
</div>
<div class="section level4" number="4.3.4">
<h4 id="sec:spikes-raman-spectra">
<span class="header-section-number">4.3.4</span> Spikes in Raman Spectra<a class="anchor" aria-label="anchor" href="#sec:spikes-raman-spectra"></a>
</h4>
<p>Correction of cosmic spikes is not a part of <code>hyperSpec</code> package, but can be addressed with algorithms presented in these papers:</p>
<ul>
<li><a href="https://chemrxiv.org/articles/A_Simple_Algorithm_for_Despiking_Raman_Spectra/5993011/2" class="external-link">A Simple Algorithm for Despiking Raman Spectra</a></li>
<li><a href="https://www.sciencedirect.com/science/article/abs/pii/S0169743916300600" class="external-link">Automatization of spike correction in Raman spectra of biological samples</a></li>
</ul>
</div>
</div>
<div class="section level3" number="4.4">
<h3 id="smoothing-interpolation">
<span class="header-section-number">4.4</span> Smoothing Interpolation<a class="anchor" aria-label="anchor" href="#smoothing-interpolation"></a>
</h3>
<p>Spectra acquired by grating instruments are frequently interpolated onto a new wavelength axis, e.g., because the unequal data point spacing should be removed.
Also, the spectra can be smoothed: reducing the spectral resolution allows to increase the signal to noise ratio.
For chemometric data analysis reducing the number of data points per spectrum may be crucial as it reduces the dimensionality of the data.
Package <strong>hyperSpec</strong> provides two functions to do so: <code class="sourceCode r"><span class="fu">spc_bin</span>()</code> and <code class="sourceCode r"><span class="fu">spc_loess</span>()</code>.</p>
<p>Function <code class="sourceCode r"><span class="fu">spc_bin</span>()</code> bins the spectral axis by averaging every <code class="sourceCode r">by</code> data points.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">paracetamol</span>, wl.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span> <span class="op">~</span> <span class="fl">1800</span>, <span class="fl">2800</span> <span class="op">~</span> <span class="va">max</span><span class="op">)</span>, xoffset <span class="op">=</span> <span class="fl">850</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: plotrix</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spc-loess.html">spc_loess</a></span><span class="op">(</span><span class="va">paracetamol</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="../reference/seq.html">seq</a></span><span class="op">(</span><span class="fl">300</span>, <span class="fl">1800</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="../reference/seq.html">seq</a></span><span class="op">(</span><span class="fl">2850</span>, <span class="fl">3150</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">p</span>, wl.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span> <span class="op">~</span> <span class="fl">1800</span>, <span class="fl">2800</span> <span class="op">~</span> <span class="va">max</span><span class="op">)</span>, xoffset <span class="op">=</span> <span class="fl">850</span>, col <span class="op">=</span> <span class="va">palette_colorblind</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spc-bin.html">spc_bin</a></span><span class="op">(</span><span class="va">paracetamol</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">b</span>,</span>
<span>  wl.range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span> <span class="op">~</span> <span class="fl">1800</span>, <span class="fl">2800</span> <span class="op">~</span> <span class="va">max</span><span class="op">)</span>, xoffset <span class="op">=</span> <span class="fl">850</span>,</span>
<span>  lines.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pch <span class="op">=</span> <span class="fl">20</span>, cex <span class="op">=</span> <span class="fl">.3</span>, type <span class="op">=</span> <span class="st">"p"</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">palette_colorblind</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:fig-loess"></span>
<img src="hyperSpec_files/figure-html/fig-loess-1.png" alt="Smoothing interpolation by `spc_loess()`{.r} with new data point spacing of 2 cm^-1^ (red) and `spc_bin()`{.r} (blue).  "><p class="caption">
Figure 4.6: Smoothing interpolation by <code class="sourceCode r"><span class="fu">spc_loess</span>()</code> with new data point spacing of 2 cm<sup>-1</sup> (red) and <code class="sourceCode r"><span class="fu">spc_bin</span>()</code> (blue).
</p>
</div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">paracetamol</span><span class="op">[</span>, , <span class="fl">1600</span> <span class="op">~</span> <span class="fl">1670</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">p</span><span class="op">[</span>, , <span class="fl">1600</span> <span class="op">~</span> <span class="fl">1670</span><span class="op">]</span>, col <span class="op">=</span> <span class="va">palette_colorblind</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span>, , <span class="fl">1600</span> <span class="op">~</span> <span class="fl">1670</span><span class="op">]</span>, col <span class="op">=</span> <span class="va">palette_colorblind</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:loess-kl"></span>
<img src="hyperSpec_files/figure-html/loess-kl-1.png" alt="The magnification of Fig. \@ref(fig:fig-loess) shows how interpolation may cause a loss in signal height.  "><p class="caption">
Figure 4.7: The magnification of Fig. <a href="#fig:fig-loess">4.6</a> shows how interpolation may cause a loss in signal height.
</p>
</div>
<p>Function <code class="sourceCode r"><span class="fu">spc_loess</span>()</code> applies R’s <code class="sourceCode r"><span class="fu">loess</span>()</code> function for spectral interpolation.
Figures <a href="#fig:fig-loess">4.6</a> and <a href="#fig:loess-kl">4.7</a> show the result of interpolating from 300 to 1800 and 2850 to 3150 cm<sup>-1</sup> with 2 cm<sup>-1</sup> data point distance.
This corresponds to a spectral resolution of about 4 cm<sup>-1</sup>, and the decrease in spectral resolution can be seen at the sharp bands where the maxima are not reached (due to the fact that the interpolation wavelength axis does not necessarily hit the maxima.
The original spectrum had 4064 data points with unequal data point spacing (between 0 and 1.4 cm<sup>-1</sup>).
The interpolated spectrum has 902 data points.</p>
</div>
<div class="section level3" number="4.5">
<h3 id="background-correction">
<span class="header-section-number">4.5</span> Background Correction<a class="anchor" aria-label="anchor" href="#background-correction"></a>
</h3>
<p>To subtract a background spectrum of each of the spectra in an object, use:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sweep.html">sweep</a></span><span class="op">(</span><span class="va">spectra</span>, <span class="fl">2</span>, <span class="va">background.spectrum</span>, <span class="st">"-"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="4.6">
<h3 id="offset-correction">
<span class="header-section-number">4.6</span> Offset Correction<a class="anchor" aria-label="anchor" href="#offset-correction"></a>
</h3>
<p>Calculate the offsets and adjust the spectra accordingly:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">offsets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span><span class="op">(</span><span class="va">faux_cell</span>, <span class="fl">1</span>, <span class="va">min</span><span class="op">)</span></span>
<span><span class="va">faux_cell_offset_corrected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sweep.html">sweep</a></span><span class="op">(</span><span class="va">faux_cell</span>, <span class="fl">1</span>, <span class="va">offsets</span>, <span class="st">"-"</span><span class="op">)</span></span></code></pre></div>
<p>If the offset is calculated by a function, as here with the <code class="sourceCode r"><span class="fu">min</span>()</code>, <code>hyperSpec</code>’s <code class="sourceCode r"><span class="fu">sweep</span>()</code> method offers a shortcut: <code class="sourceCode r"><span class="fu">sweep</span>()</code>’s <code class="sourceCode r">STATS</code> argument may be the function instead of a numeric vector:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">faux_cell_offset_corrected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sweep.html">sweep</a></span><span class="op">(</span><span class="va">faux_cell</span>, <span class="fl">1</span>, <span class="va">min</span>, <span class="st">"-"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="4.7">
<h3 id="baseline-correction">
<span class="header-section-number">4.7</span> Baseline Correction<a class="anchor" aria-label="anchor" href="#baseline-correction"></a>
</h3>
<p>Package <strong>hyperSpec</strong> comes with two functions to fit polynomial baselines.</p>
<p>Functions <code class="sourceCode r"><span class="fu">spc_fit_poly_below</span>()</code>, <code class="sourceCode r"><span class="fu">spc_fit_poly</span>()</code> fit a polynomial baseline of the given order.
A least-squares fit is done so that the function may be used on rather noisy spectra.
However, the user must supply an object that is cut appropriately.
Particularly, the supplied wavelength ranges are not weighted.</p>
<p>Function <code class="sourceCode r"><span class="fu">spc_fit_poly_below</span>()</code> tries to find appropriate support points for the baseline iteratively.</p>
<p>Both functions return a <code>hyperSpec</code> object containing the fitted baselines.
They need to be subtracted afterwards:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/baselines.html">spc_fit_poly_below</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span></span>
<span><span class="va">faux_cell_tmp</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span> <span class="op">-</span> <span class="va">bl</span></span></code></pre></div>
<p>For details, see <a href="#list-of-vignettes">baseline</a> vignette.</p>
<p>Package package <strong>baseline</strong><span class="citation">[<a href="#ref-R-baseline" role="doc-biblioref">3</a>,<a href="#ref-baseline2010" role="doc-biblioref">4</a>]</span> offers many more functions for baseline correction.
The <code class="sourceCode r"><span class="fu">baseline</span>()</code> function works on the spectra matrix, which is extracted by <code>[[]]</code>.
The result is a <code class="sourceCode r">baseline</code> object, but can easily be re-imported into the <code>hyperSpec</code> object:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corrected</span> <span class="op">&lt;-</span> <span class="fu">hyperSpec</span><span class="fu">::</span><span class="va"><a href="../reference/faux_cell.html">faux_cell</a></span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="co"># start with the unchanged data set</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/khliland/baseline/" class="external-link">"baseline"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'baseline'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:pls':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     mvrValstats</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     getCall</span></span>
<span><span class="va">bl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/baseline/man/baseline.html" class="external-link">baseline</a></span><span class="op">(</span><span class="va">corrected</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span>, method <span class="op">=</span> <span class="st">"modpolyfit"</span>, degree <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">corrected</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/baseline/man/getBaseline.html" class="external-link">getCorrected</a></span><span class="op">(</span><span class="va">bl</span><span class="op">)</span></span></code></pre></div>
<p>Fig. <a href="#fig:bl-baseline">4.8</a> and <a href="#fig:bl-baseline-2">4.9</a> show raw data and the result for the first spectrum of <code class="sourceCode r">faux_cell</code>.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">baseline</span> <span class="op">&lt;-</span> <span class="va">corrected</span></span>
<span><span class="va">baseline</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/baseline/man/getBaseline.html" class="external-link">getBaseline</a></span><span class="op">(</span><span class="va">bl</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="fu">hyperSpec</span><span class="fu">::</span><span class="va"><a href="../reference/faux_cell.html">faux_cell</a></span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, plot.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu">hyperSpec</span><span class="fu">::</span><span class="va"><a href="../reference/faux_cell.html">faux_cell</a></span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">baseline</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="va">palette_colorblind</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:bl-baseline"></span>
<img src="hyperSpec_files/figure-html/bl-baseline-1.png" alt="The first spectrum of `faux_cell`{.r} (raw data) with baseline.  "><p class="caption">
Figure 4.8: The first spectrum of <code class="sourceCode r">faux_cell</code> (raw data) with baseline.
</p>
</div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">corrected</span>, plot.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu">hyperSpec</span><span class="fu">::</span><span class="va"><a href="../reference/faux_cell.html">faux_cell</a></span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:bl-baseline-2"></span>
<img src="hyperSpec_files/figure-html/bl-baseline-2-1.png" alt='Baseline correction using the **baseline** package:
the first spectrum of `faux_cell`{.r}  after baseline correction with method "odpolyfi".  '><p class="caption">
Figure 4.9: Baseline correction using the <strong>baseline</strong> package:
the first spectrum of <code class="sourceCode r">faux_cell</code> after baseline correction with method “odpolyfi”.
</p>
</div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">bl</span>, <span class="va">faux_cell</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="4.8">
<h3 id="intensity-calibration">
<span class="header-section-number">4.8</span> Intensity Calibration<a class="anchor" aria-label="anchor" href="#intensity-calibration"></a>
</h3>
<div class="section level4" number="4.8.1">
<h4 id="correcting-by-a-constant-e--g--readout-bias">
<span class="header-section-number">4.8.1</span> Correcting by a Constant, e. g. Readout Bias<a class="anchor" aria-label="anchor" href="#correcting-by-a-constant-e--g--readout-bias"></a>
</h4>
<p>CCD cameras often operate with a bias, causing a constant value for each pixel.
Such a constant can be immediately subtracted: <code class="sourceCode r">spectra <span class="sc">-</span> constant</code>.</p>
</div>
<div class="section level4" number="4.8.2">
<h4 id="correcting-wavelength-dependence">
<span class="header-section-number">4.8.2</span> Correcting Wavelength Dependence<a class="anchor" aria-label="anchor" href="#correcting-wavelength-dependence"></a>
</h4>
<p>For each of the wavelengths the same correction needs to be applied to all spectra.</p>
<ol style="list-style-type: decimal">
<li>
<p>There might be wavelength dependent offsets (background or dark spectra).
They are subtracted:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sweep.html">sweep</a></span><span class="op">(</span><span class="va">spectra</span>, <span class="fl">2</span>, <span class="va">offset.spectrum</span>, <span class="st">"-"</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p>A multiplicative dependency such as a CCD’s photon efficiency:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sweep.html">sweep</a></span><span class="op">(</span><span class="va">spectra</span>, <span class="fl">2</span>, <span class="va">photon.efficiency</span>, <span class="st">"/"</span><span class="op">)</span></span></code></pre></div>
</li>
</ol>
</div>
<div class="section level4" number="4.8.3">
<h4 id="spectra-dependent-correction">
<span class="header-section-number">4.8.3</span> Spectra Dependent Correction<a class="anchor" aria-label="anchor" href="#spectra-dependent-correction"></a>
</h4>
<p>If the correction depends on the spectra (e. g. due to inhomogeneous illumination while collecting imaging data, differing optical path length, etc.), the <code class="sourceCode r">MARGIN</code> of the <code class="sourceCode r"><span class="fu">sweep</span>()</code> function needs to be 1 or <code class="sourceCode r">SPC</code>:</p>
<ol style="list-style-type: decimal">
<li>
<p>Pixel dependent offsets are subtracted:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sweep.html">sweep</a></span><span class="op">(</span><span class="va">spectra</span>, <span class="va">SPC</span>, <span class="va">pixel.offsets</span>, <span class="st">"-"</span><span class="op">)</span></span></code></pre></div>
</li>
<li>
<p>A multiplicative dependency:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sweep.html">sweep</a></span><span class="op">(</span><span class="va">spectra</span>, <span class="va">SPC</span>, <span class="va">illumination.factors</span>, <span class="st">"*"</span><span class="op">)</span></span></code></pre></div>
</li>
</ol>
</div>
</div>
<div class="section level3" number="4.9">
<h3 id="normalization">
<span class="header-section-number">4.9</span> Normalization<a class="anchor" aria-label="anchor" href="#normalization"></a>
</h3>
<p>Again, <code class="sourceCode r"><span class="fu">sweep</span>()</code> is the function of choice.
E.g., for area normalization, use:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">faux_cell_tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sweep.html">sweep</a></span><span class="op">(</span><span class="va">faux_cell</span>, <span class="fl">1</span>, <span class="va">mean</span>, <span class="st">"/"</span><span class="op">)</span></span></code></pre></div>
<p>(Using the mean instead of the sum results in conveniently scaled spectra with intensities around 1.)</p>
<p>If the calculation of the normalization factors is more elaborate, use a two step procedure:</p>
<ol style="list-style-type: decimal">
<li><p>Calculate appropriate normalization factors
You may calculate the factors using only a certain wavelength range, thereby normalizing on a particular band or peak.</p></li>
<li>
<p>Again, sweep the factor off the spectra:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">normalized</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sweep.html">sweep</a></span><span class="op">(</span><span class="va">spectra</span>, <span class="fl">1</span>, <span class="va">factors</span>, <span class="st">"*"</span><span class="op">)</span></span></code></pre></div>
</li>
</ol>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">factors</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="../reference/apply.html">apply</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[</span>, , <span class="fl">1600</span> <span class="op">~</span> <span class="fl">1700</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">faux_cell_tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sweep.html">sweep</a></span><span class="op">(</span><span class="va">faux_cell</span>, <span class="fl">1</span>, <span class="va">factors</span>, <span class="st">"*"</span><span class="op">)</span></span></code></pre></div>
<p>For the special case of area normalization using the <code class="sourceCode r">mean</code> spectra, the factors can be more conveniently calculated by</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">factors</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[</span>, , <span class="fl">1600</span> <span class="op">~</span> <span class="fl">1700</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>and instead of <code class="sourceCode r">sweep</code> the arithmetic operators (here <code class="sourceCode r"><span class="sc">*</span></code>) can be used directly with the normalization factor:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">faux_cell_tmp</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span> <span class="op">*</span> <span class="va">factors</span></span></code></pre></div>
<p>Put together, this results in:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">faux_cell_tmp</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[</span>, , <span class="fl">1600</span> <span class="op">~</span> <span class="fl">1700</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>For minimum-maximum-normalization, first do an offset- or baseline correction, then normalize using <code class="sourceCode r"><span class="fu">max</span>()</code>.</p>
</div>
<div class="section level3" number="4.10">
<h3 id="centering-and-variance-scaling-the-spectra">
<span class="header-section-number">4.10</span> Centering and Variance Scaling the Spectra<a class="anchor" aria-label="anchor" href="#centering-and-variance-scaling-the-spectra"></a>
</h3>
<p>Centering means that the mean spectrum is subtracted from each of the spectra.
Many data analysis techniques, like principal component analysis, partial least squares, etc., work much better on centered data.
From a spectroscopic point of view it depends on the particular data set whether centering does make sense or not.</p>
<p>Variance scaling is often used in multivariate analysis to adjust the influence and scaling of the variates (that are typically different physical values).
However, spectra already do have the same scale of the same physical value.
Thus one has to trade off the the expected numeric benefit with the fact that for wavelengths with low signal the noise level will greatly increase when using variance scaling.
Scaling usually makes sense only for centered data.</p>
<p>Both tasks are carried out by the same method in <code>R</code>, <code class="sourceCode r"><span class="fu">scale</span>()</code>, which will by default both mean center and variance scale the spectra matrix.</p>
<p>To center the <code class="sourceCode r">flu</code> data set, use:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flu.centered</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scale.html">scale</a></span><span class="op">(</span><span class="va">flu</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">flu.centered</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:centre-flu"></span>
<img src="hyperSpec_files/figure-html/centre-flu-1.png" alt="Mean-centered spectra of `flu`.  "><p class="caption">
Figure 4.10: Mean-centered spectra of <code>flu</code>.
</p>
</div>
<p>On the other hand, the <code class="sourceCode r">faux_cell</code> data set consists of Raman spectra, so the spectroscopic interpretation of centering is getting rid of the the average chemical composition of the sample.
But what is the meaning of the “Average spectrum” of an inhomogeneous sample?
In this case it may be better to subtract the minimum spectrum (which will hopefully have almost the same benefit on the data analysis) as it is the spectrum of that chemical composition that is underlying the whole sample.</p>
<p>One more point to consider is that the actual minimum spectrum will pick up (negative) noise.
In order to avoid that, using, e.g., the 5<sup>th</sup> percentile spectrum is more suitable:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">faux_cell_tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scale.html">scale</a></span><span class="op">(</span><span class="va">faux_cell</span>, center <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">faux_cell</span>, <span class="fl">0.05</span><span class="op">)</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">faux_cell_tmp</span>, <span class="st">"spcprctl5"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:perc"></span>
<img src="hyperSpec_files/figure-html/perc-1.png" alt="The summary spectra of `faux_cell` with 5^th^ percentile subtracted.  "><p class="caption">
Figure 4.11: The summary spectra of <code>faux_cell</code> with 5<sup>th</sup> percentile subtracted.
</p>
</div>
<p>See section the appendices for some tips to speed up these calculations.</p>
</div>
<div class="section level3" number="4.11">
<h3 id="multiplicative-scatter-correction">
<span class="header-section-number">4.11</span> Multiplicative Scatter Correction<a class="anchor" aria-label="anchor" href="#multiplicative-scatter-correction"></a>
</h3>
<p>Multiplicative scatter correction (MSC) can be done using <code class="sourceCode r"><span class="fu">msc</span>()</code> from package package <strong>pls</strong> <span class="citation">[<a href="#ref-R-pls" role="doc-biblioref">5</a>]</span>.
It operates on the spectra matrix:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/khliland/pls" class="external-link">pls</a></span><span class="op">)</span></span>
<span><span class="va">faux_cell_msc</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span></span>
<span><span class="va">faux_cell_msc</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/pls/man/msc.html" class="external-link">msc</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="4.12">
<h3 id="spectral-arithmetic">
<span class="header-section-number">4.12</span> Spectral Arithmetic<a class="anchor" aria-label="anchor" href="#spectral-arithmetic"></a>
</h3>
<p>Basic mathematical functions are defined for <code>hyperSpec</code> objects.
You may convert spectra to their log:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">absorbance.spectra</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log10</a></span><span class="op">(</span><span class="va">transmission.spectra</span><span class="op">)</span></span></code></pre></div>
<p>In this case, do not forget to adapt the label:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/labels.html" class="external-link">labels</a></span><span class="op">(</span><span class="va">absorbance.spectra</span><span class="op">)</span><span class="op">$</span><span class="va">spc</span> <span class="op">&lt;-</span> <span class="st">"A"</span></span></code></pre></div>
<p>Be careful: <code>R</code>’s <code class="sourceCode r"><span class="fu">log</span>()</code> function calculates the <em>natural</em> logarithm if no base is given.</p>
<p>The basic arithmetic operators work element-wise in <code>R</code>.
Thus they all need either a scalar, or a matrix (or <code>hyperSpec</code> object) of the correct size.</p>
<p>Matrix multiplication is done by <code>%*%</code>, again each of the operands may be a matrix or a <code>hyperSpec</code> object, and must have the correct dimensions.</p>
<p>There are many more mathematical functions that understand a <code>hyperSpec</code> object.
See <code>?Arith</code> for more details.</p>
</div>
</div>
<div class="section level2" number="5">
<h2 id="data-analysis">
<span class="header-section-number">5</span> Data Analysis<a class="anchor" aria-label="anchor" href="#data-analysis"></a>
</h2>
<div class="section level3" number="5.1">
<h3 id="sec:pca">
<span class="header-section-number">5.1</span> Principal Component Analysis with <code class="sourceCode r"><span class="fu">prcomp</span>()</code><a class="anchor" aria-label="anchor" href="#sec:pca"></a>
</h3>
<div class="section level4" number="5.1.1">
<h4 id="carrying-out-pca">
<span class="header-section-number">5.1.1</span> Carrying out PCA<a class="anchor" aria-label="anchor" href="#carrying-out-pca"></a>
</h4>
<p>The <code class="sourceCode r"><span class="sc">$</span>.</code> notation is handy, if a data analysis function expects a <code class="sourceCode r">data.frame</code>, as <code class="sourceCode r"><span class="fu">prcomp</span>()</code> does.
The column names can then be used in the formula:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="op">~</span><span class="va">spc</span>, data <span class="op">=</span> <span class="va">faux_cell</span><span class="op">$</span><span class="va">.</span>, center <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>However, many modeling functions call <code class="sourceCode r">as.data.frame</code> on their <code class="sourceCode r">data</code> argument, including <code class="sourceCode r"><span class="fu">prcomp</span>()</code>.
In that case, the conversion is done automatically so the following gives the same result as above:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="op">~</span><span class="va">spc</span>, data <span class="op">=</span> <span class="va">faux_cell</span>, center <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4" number="5.1.2">
<h4 id="plotting-the-results-of-pca">
<span class="header-section-number">5.1.2</span> Plotting the Results of PCA<a class="anchor" aria-label="anchor" href="#plotting-the-results-of-pca"></a>
</h4>
<p>The results of such a  decomposition can be put back into <code>hyperSpec</code> objects.
This conveniently allows one to use the regular <code>hyperSpec</code> plotting functions, e.g., the loading-like spectra, or score maps, see Figures <a href="#fig:pca-load">5.1</a> and <a href="#fig:pca-score">5.2</a>.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decomposition.html">decomposition</a></span><span class="op">(</span><span class="va">faux_cell</span>, <span class="va">pca</span><span class="op">$</span><span class="va">x</span>,</span>
<span>  label.wavelength <span class="op">=</span> <span class="st">"PC"</span>,</span>
<span>  label.spc <span class="op">=</span> <span class="st">"score / a.u."</span></span>
<span><span class="op">)</span></span>
<span><span class="va">scores</span></span>
<span><span class="co">#&gt; hyperSpec object</span></span>
<span><span class="co">#&gt;    875 spectra</span></span>
<span><span class="co">#&gt;    4 data columns</span></span>
<span><span class="co">#&gt;    300 data points / spectrum</span></span></code></pre></div>
<p>The loadings can be similarly re-imported:</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loadings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decomposition.html">decomposition</a></span><span class="op">(</span><span class="va">faux_cell</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">pca</span><span class="op">$</span><span class="va">rotation</span><span class="op">)</span>,</span>
<span>  scores <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  label.spc <span class="op">=</span> <span class="st">"loading I / a.u."</span></span>
<span><span class="op">)</span></span>
<span><span class="va">loadings</span></span>
<span><span class="co">#&gt; hyperSpec object</span></span>
<span><span class="co">#&gt;    300 spectra</span></span>
<span><span class="co">#&gt;    1 data columns</span></span>
<span><span class="co">#&gt;    300 data points / spectrum</span></span></code></pre></div>
<p>There is, however, one important difference.
The loadings are thought of as values computed from all spectra together.
Thus no meaningful extra data can be assigned for the loadings object (at least not if the column consists of different values).
Therefore, the loadings object lost all extra data (see above).</p>
<p>Argument <code class="sourceCode r">retain.columns</code> triggers whether columns that contain different values should be dropped.
If it is set to <code class="sourceCode r"><span class="cn">TRUE</span></code>, the columns are retained, but contain <code class="sourceCode r"><span class="cn">NA</span></code>s:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">loadings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decomposition.html">decomposition</a></span><span class="op">(</span><span class="va">faux_cell</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">pca</span><span class="op">$</span><span class="va">rotation</span><span class="op">)</span>,</span>
<span>  scores <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  retain.columns <span class="op">=</span> <span class="cn">TRUE</span>, label.spc <span class="op">=</span> <span class="st">"loading I / a.u."</span></span>
<span><span class="op">)</span></span>
<span><span class="va">loadings</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">$</span><span class="va">..</span></span>
<span><span class="co">#&gt;      x  y region</span></span>
<span><span class="co">#&gt; PC1 NA NA   &lt;NA&gt;</span></span></code></pre></div>
<p>If an extra data column does contain only one unique value, it is retained regardless:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">faux_cell</span><span class="op">$</span><span class="va">measurement</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">loadings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/decomposition.html">decomposition</a></span><span class="op">(</span><span class="va">faux_cell</span>, <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">pca</span><span class="op">$</span><span class="va">rotation</span><span class="op">)</span>,</span>
<span>  scores <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  label.spc <span class="op">=</span> <span class="st">"loading I / a.u."</span></span>
<span><span class="op">)</span></span>
<span><span class="va">loadings</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">$</span><span class="va">..</span></span>
<span><span class="co">#&gt;     measurement</span></span>
<span><span class="co">#&gt; PC1           1</span></span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">loadings</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, stacked <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:pca-load"></span>
<img src="hyperSpec_files/figure-html/pca-load-1.png" alt="The first three loadings.  "><p class="caption">
Figure 5.1: The first three loadings.
</p>
</div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">div_palette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"#00008B"</span>, <span class="st">"#351C96"</span>, <span class="st">"#5235A2"</span>, <span class="st">"#6A4CAE"</span>, <span class="st">"#8164BA"</span>, <span class="st">"#967CC5"</span>,</span>
<span>  <span class="st">"#AC95D1"</span>, <span class="st">"#C1AFDC"</span>, <span class="st">"#D5C9E8"</span>, <span class="st">"#E0E3E3"</span>, <span class="st">"#F8F8B0"</span>, <span class="st">"#F7E6C2"</span>,</span>
<span>  <span class="st">"#EFCFC6"</span>, <span class="st">"#E6B7AB"</span>, <span class="st">"#DCA091"</span>, <span class="st">"#D08977"</span>, <span class="st">"#C4725E"</span>, <span class="st">"#B75B46"</span>,</span>
<span>  <span class="st">"#A9432F"</span>, <span class="st">"#9A2919"</span>, <span class="st">"#8B0000"</span></span>
<span><span class="op">)</span>, space <span class="op">=</span> <span class="st">"Lab"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/levelplot.html">plotmap</a></span><span class="op">(</span><span class="va">scores</span><span class="op">[</span>, , <span class="fl">3</span><span class="op">]</span>, col.regions <span class="op">=</span> <span class="fu">diverging_hcl</span><span class="op">(</span><span class="fl">20</span>, palette <span class="op">=</span> <span class="st">"Blue-Red2"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:pca-score"></span>
<img src="hyperSpec_files/figure-html/pca-score-1.png" alt="The third score map.  "><p class="caption">
Figure 5.2: The third score map.
</p>
</div>
</div>
<div class="section level4" number="5.1.3">
<h4 id="sec:pca-as-noise">
<span class="header-section-number">5.1.3</span> PCA as Noise Filter<a class="anchor" aria-label="anchor" href="#sec:pca-as-noise"></a>
</h4>
<p>Principal component analysis is sometimes used as a noise filtering technique.
The idea is that the relevant differences are captured in the first few components while the higher components contain noise only.
Thus the spectra are reconstructed using only the first <span class="math inline">\(p\)</span> components.</p>
<p>This reconstruction is in fact a matrix multiplication:</p>
<!-- Equation ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  -->
<p><span class="math display" id="eq:equation-1">\[\begin{equation}

  \mathrm{spectra}^{\mathrm{~nrow} ~×~ \mathrm{nwl}} = \mathrm{scores}^{\mathrm{~nrow} ~×~ p} \;\cdot\; \mathrm{loadings}^{~p ~×~ \mathrm{nwl}}
  \tag{5.1}

\end{equation}\]</span>
<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  --></p>
<p>Note that this corresponds to a model based on the Beer-Lambert law:
<!-- Equation ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  -->
<span class="math display" id="eq:equation-2">\[\begin{equation}

  A_n (\lambda) = c_{n,i} \epsilon (i, \lambda) + \mathrm{error}
  \tag{5.2}

\end{equation}\]</span>
<!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~  -->
The matrix formulation puts the <span class="math inline">\(n\)</span> spectra into the rows of <span class="math inline">\(A\)</span> and <span class="math inline">\(c\)</span>, while the <span class="math inline">\(i\)</span> pure components appear in the columns of <span class="math inline">\(c\)</span> and rows of the absorbance coefficients <span class="math inline">\(\epsilon\)</span>.</p>
<p>For an ideal data set (constituents varying independently, sufficient signal to noise ratio) one would expect the principal component analysis to extract something like the concentrations and pure component spectra.</p>
<p>If we decide that only the first 10 components actually carry spectroscopic information, we can reconstruct spectra with better signal to noise ratio:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smoothed</span> <span class="op">&lt;-</span> <span class="va">scores</span><span class="op">[</span>, , <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">loadings</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span></span></code></pre></div>
<p>Keep in mind, though, that we cannot be sure how much <em>useful</em> information was discarded with the higher components.
This kind of noise reduction may influence further modeling of the data.
Mathematically speaking, the rank of the new 875 <span class="math inline">\(×\)</span> 300 spectra matrix is only 10.</p>
</div>
</div>
<div class="section level3" number="5.2">
<h3 id="HCA">
<span class="header-section-number">5.2</span> Hierarchical Cluster Analysis<a class="anchor" aria-label="anchor" href="#HCA"></a>
</h3>
<p>Some <code>R</code> functions expect their input data in a matrix, including those related to HCA.
Conveniently, the <code class="sourceCode r">[[]]</code> extraction function returns a matrix.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dist_pearson.html">dist_pearson</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Again, many such functions coerce the data to a matrix automatically, so the <code>hyperSpec</code> object can be handed over without the explicit conversion above (as we saw for PCA):</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dist_pearson.html">dist_pearson</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">)</span></span>
<span><span class="va">dendrogram</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/hclust.html" class="external-link">hclust</a></span><span class="op">(</span><span class="va">dist</span>, method <span class="op">=</span> <span class="st">"ward.D"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">dendrogram</span>, labels <span class="op">=</span> <span class="cn">FALSE</span>, hang <span class="op">=</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:dend"></span>
<img src="hyperSpec_files/figure-html/dend-1.png" alt="The results of the cluster analysis: the dendrogram.  "><p class="caption">
Figure 5.3: The results of the cluster analysis: the dendrogram.
</p>
</div>
<p>In order to plot a cluster map, the cluster membership needs to be calculated from the dendrogram.</p>
<p>First, cut the dendrogram so that three clusters result:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">faux_cell</span><span class="op">$</span><span class="va">region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cutree.html" class="external-link">cutree</a></span><span class="op">(</span><span class="va">dendrogram</span>, k <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>As the cluster membership was stored as factor, the levels can be meaningful names, which are displayed in the color legend.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">$</span><span class="va">region</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"matrix"</span>, <span class="st">"lacuna"</span>, <span class="st">"cell"</span><span class="op">)</span></span></code></pre></div>
<p>Then the result may be plotted (Figure <a href="#fig:clust-map">5.4</a>):</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/levelplot.html">plotmap</a></span><span class="op">(</span><span class="va">faux_cell</span>, <span class="va">region</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span>, col.regions <span class="op">=</span> <span class="va">cluster.cols</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:clust-map"></span>
<img src="hyperSpec_files/figure-html/clust-map-1.png" alt="The results of the cluster analysis: the map of the 3 clusters.  "><p class="caption">
Figure 5.4: The results of the cluster analysis: the map of the 3 clusters.
</p>
</div>
</div>
<div class="section level3" number="5.3">
<h3 id="calculating-group-wise-sum-characteristics-e--g--cluster-mean-spectra">
<span class="header-section-number">5.3</span> Calculating Group-Wise Sum Characteristics, e. g. Cluster Mean Spectra<a class="anchor" aria-label="anchor" href="#calculating-group-wise-sum-characteristics-e--g--cluster-mean-spectra"></a>
</h3>
<p>Function <code class="sourceCode r"><span class="fu">aggregate</span>()</code> applies the function given in <code class="sourceCode r">FUN</code> to each of the groups of spectra specified in <code class="sourceCode r">by</code>.</p>
<p>So we may plot the cluster mean spectra:</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">faux_cell</span>, by <span class="op">=</span> <span class="va">faux_cell</span><span class="op">$</span><span class="va">region</span>, <span class="va">mean_pm_sd</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">means</span>, col <span class="op">=</span> <span class="va">cluster.cols</span>, stacked <span class="op">=</span> <span class="st">".aggregate"</span>, fill <span class="op">=</span> <span class="st">".aggregate"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:clustmean"></span>
<img src="hyperSpec_files/figure-html/clustmean-1.png" alt="The results of the cluster analysis: the the mean spectra.  "><p class="caption">
Figure 5.5: The results of the cluster analysis: the the mean spectra.
</p>
</div>
</div>
</div>
<div class="section level2" number="6">
<h2 id="sec:combine">
<span class="header-section-number">6</span> Combining and Splitting <code>hyperSpec</code> Objects<a class="anchor" aria-label="anchor" href="#sec:combine"></a>
</h2>
<div class="section level3" number="6.1">
<h3 id="sec:bind">
<span class="header-section-number">6.1</span> Binding Objects Together<a class="anchor" aria-label="anchor" href="#sec:bind"></a>
</h3>
<p>Class <code>hyperspec</code> objects can be bound together, either by columns (<code class="sourceCode r"><span class="fu">cbind</span>()</code>) to append a new spectral range or by row (<code class="sourceCode r"><span class="fu">rbind</span>()</code>) to append new spectra:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">flu</span><span class="op">)</span></span>
<span><span class="co">#&gt; nrow ncol  nwl </span></span>
<span><span class="co">#&gt;    6    4    5</span></span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">flu</span>, <span class="va">flu</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; nrow ncol  nwl </span></span>
<span><span class="co">#&gt;    6    4   10</span></span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">flu</span>, <span class="va">flu</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; nrow ncol  nwl </span></span>
<span><span class="co">#&gt;   12    4    5</span></span></code></pre></div>
<p>There is also a more general function, <code class="sourceCode r"><span class="fu">bind</span>()</code>, taking the direction (<code class="sourceCode r"><span class="st">"r"</span></code> or <code class="sourceCode r"><span class="st">"c"</span></code>) as first argument followed by the objects to bind either in separate arguments or in a list.</p>
<p>As usual for <code class="sourceCode r"><span class="fu">rbind</span>()</code> and <code class="sourceCode r"><span class="fu">cbind</span>()</code>, the objects that should be bound together must have
the same number of columns (for <code class="sourceCode r"><span class="fu">rbind</span>()</code>) and the same number of rows (for <code class="sourceCode r"><span class="fu">cbind</span>()</code>),
respectively.</p>
<p>For binding row-wise (<code class="sourceCode r"><span class="fu">rbind</span>()</code>), <code class="sourceCode r"><span class="fu">collapse</span>()</code> is more flexible and faster as well.</p>
</div>
<div class="section level3" number="6.2">
<h3 id="sec:collapse">
<span class="header-section-number">6.2</span> Binding Objects that Do not Share the Same Extra Data and/or Wavelength Axis<a class="anchor" aria-label="anchor" href="#sec:collapse"></a>
</h3>
<p>Function <code class="sourceCode r"><span class="fu">collapse</span>()</code> combines objects that should be bound together by row, but they do not share the columns and/or spectral range.
The resulting object has all columns from all input objects, and all wavelengths from the input objects.
If an input object does not have a particular column or wavelength, its value in the resulting object is <code class="sourceCode r"><span class="cn">NA</span></code>.</p>
<p>The <code class="sourceCode r">barbiturates</code> data is a list of 5 <code>hyperSpec</code> objects, each containing one mass spectrum.
The spectra have between 22 and 37 data points each.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">barb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collapse.html">collapse</a></span><span class="op">(</span><span class="va">barbiturates</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">barb</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">25</span><span class="op">]</span></span>
<span><span class="co">#&gt;  [1] 27.05 27.15 28.05 28.15 29.05 30.05 30.15 31.15 32.15 38.90 39.00 40.00 40.10 41.10 43.05 43.85</span></span>
<span><span class="co">#&gt; [17] 43.95 44.05 55.00 55.10 56.00 56.10 57.00 57.10 68.90</span></span></code></pre></div>
<p>The resulting object does not have an ordered wavelength axis.
This can be obtained in the second step:</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">barb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl_sort.html">wl_sort</a></span><span class="op">(</span><span class="va">barb</span><span class="op">)</span></span>
<span><span class="va">barb</span><span class="op">[[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, , <span class="va">min</span> <span class="op">~</span> <span class="va">min</span> <span class="op">+</span> <span class="fl">10i</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt;      27.05 27.15 28.05 28.15 29.05 30.05 30.15 31.15 32.15 38.9  39</span></span>
<span><span class="co">#&gt; [1,]   562    NA    NA 11511  6146  1253    NA  9851 10751   NA 756</span></span>
<span><span class="co">#&gt; [2,]    NA   618 10151    NA  5040    NA   910  8200 10989   NA 770</span></span>
<span><span class="co">#&gt; [3,]   638    NA    NA 10722  5253   966    NA  8709 10899   NA  NA</span></span></code></pre></div>
</div>
<div class="section level3" number="6.3">
<h3 id="sec:merge">
<span class="header-section-number">6.3</span> Binding Objects that Do not Share the Same Spectra<a class="anchor" aria-label="anchor" href="#sec:merge"></a>
</h3>
<p>Function <code class="sourceCode r"><span class="fu">merge</span>()</code> adds a new spectral range (like <code class="sourceCode r"><span class="fu">cbind</span>()</code>), but works also if spectra are missing in one of the objects.
The arguments <code class="sourceCode r">by</code>, <code class="sourceCode r">by.x</code>, and <code class="sourceCode r">by.y</code> specify which columns should be used to decide which spectra are the same.
The arguments <code class="sourceCode r">all</code>, <code class="sourceCode r">all.x</code>, and <code class="sourceCode r">all.y</code> determine whether spectra should be kept for the result set if they appear in only one of the objects.
For details, see also the help on the base function <code class="sourceCode r"><span class="fu">merge</span>()</code>.</p>
<p>As an example, let’s construct a version of the <code class="sourceCode r">faux_cell</code> data like being taken as two maps with different spectral ranges.
In each data set, some spectra are missing.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">faux_cell_low</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample.html">sample</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[</span>, , <span class="va">min</span> <span class="op">~</span> <span class="fl">1200</span><span class="op">]</span>, <span class="fl">700</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">faux_cell_low</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 700</span></span></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">faux_cell_high</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sample.html">sample</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[</span>, , <span class="fl">1400</span> <span class="op">~</span> <span class="va">max</span><span class="op">]</span>, <span class="fl">700</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">faux_cell_high</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 700</span></span></code></pre></div>
<p>As all extra data columns are the same, no special declarations are needed for merging the data:</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">faux_cell_merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge.html">merge</a></span><span class="op">(</span><span class="va">faux_cell_low</span>, <span class="va">faux_cell_high</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">faux_cell_merged</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 559</span></span></code></pre></div>
<p>By default, the result consists of only those spectra, where <em>both</em> spectral ranges were available.
To keep all spectra replacing missing parts by <code class="sourceCode r"><span class="cn">NA</span></code> (see Fig. <a href="#fig:merge-map">6.1</a>, <a href="#fig:merge-mat">6.2</a>):</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">faux_cell_merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge.html">merge</a></span><span class="op">(</span><span class="va">faux_cell_low</span>, <span class="va">faux_cell_high</span>, all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">faux_cell_merged</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 841</span></span></code></pre></div>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matcols</span> <span class="op">&lt;-</span> <span class="fu">sequential_hcl</span><span class="op">(</span><span class="fl">20</span>, palette <span class="op">=</span> <span class="st">"viridis"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/levelplot.html" class="external-link">levelplot</a></span><span class="op">(</span><span class="va">spc</span> <span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">y</span> <span class="op">|</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">.wavelength</span>, <span class="st">"  1/cm"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">faux_cell_merged</span><span class="op">[</span>, , <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1650</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  aspect <span class="op">=</span> <span class="st">"iso"</span>, col.regions <span class="op">=</span> <span class="va">matcols</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:merge-map"></span>
<img src="hyperSpec_files/figure-html/merge-map-1.png" alt="For both spectral ranges some spectra are missing. "><p class="caption">
Figure 6.1: For both spectral ranges some spectra are missing.
</p>
</div>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">faux_cell_merged</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span>, <span class="st">"mat"</span>, col <span class="op">=</span> <span class="va">matcols</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:merge-mat"></span>
<img src="hyperSpec_files/figure-html/merge-mat-1.png" alt="The missing parts of the spectra are filled with `NA`{.r}.  "><p class="caption">
Figure 6.2: The missing parts of the spectra are filled with <code class="sourceCode r"><span class="cn">NA</span></code>.
</p>
</div>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge.html">merge</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span>, , <span class="fl">610</span> <span class="op">~</span> <span class="fl">620</span><span class="op">]</span>, <span class="va">faux_cell</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">10</span>, , <span class="fl">615</span> <span class="op">~</span> <span class="fl">625</span><span class="op">]</span>, all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">merged</span><span class="op">$</span><span class="va">.</span></span>
<span><span class="co">#&gt;         x     y region measurement .nx .ny spc.1 spc.2 spc.3 spc.4 spc.5 spc.6 spc.7</span></span>
<span><span class="co">#&gt; 1  -11.55 -4.77 matrix           1   1  NA   150   128   143    NA    NA    NA    NA</span></span>
<span><span class="co">#&gt; 2  -10.55 -4.77 matrix           1   2  NA    99    84    54    NA    NA    NA    NA</span></span>
<span><span class="co">#&gt; 3   -9.55 -4.77 matrix           1   3  NA   142   118   125    NA    NA    NA    NA</span></span>
<span><span class="co">#&gt; 4   -8.55 -4.77 matrix           1   4  NA    83   108   126    NA    NA    NA    NA</span></span>
<span><span class="co">#&gt; 5   -7.55 -4.77 matrix           1   5   1    27    19    23    19    23    27    31</span></span>
<span><span class="co">#&gt; 6   -6.55 -4.77 matrix           1   6   2    14    18    12    18    12    20    17</span></span>
<span><span class="co">#&gt; 7   -5.55 -4.77 matrix           1   7   3    22    24    23    24    23    28    31</span></span>
<span><span class="co">#&gt; 8   -4.55 -4.77 matrix           1  NA   4    NA    NA    NA    74    78    86    81</span></span>
<span><span class="co">#&gt; 9   -3.55 -4.77 matrix           1  NA   5    NA    NA    NA     0     0     0     1</span></span>
<span><span class="co">#&gt; 10  -2.55 -4.77 matrix           1  NA   6    NA    NA    NA   122   129   135   119</span></span></code></pre></div>
<p>If the spectra overlap, the result will have both data points.
In the example here one could easily delete duplicate wavelengths.
For real data, however, the duplicated wavelength will hardly ever contain the same values.
The appropriate method to deal with this situation depends on the data at hand, but it will usually be some kind of spectral interpolation.</p>
<p>One possibility is removing duplicated wavelengths by using the mean intensity.
This can conveniently be done by using <code class="sourceCode r"><span class="fu">approx</span>()</code> using <code class="sourceCode r">method <span class="ot">=</span> <span class="st">"constant"</span></code>.
For duplicated wavelengths, the intensities will be combined by the tie function.
This already defaults to the mean, but we need <code class="sourceCode r">na.rm <span class="ot">=</span> <span class="cn">TRUE</span></code>.</p>
<p>Thus, the function to calculate the new spectral intensities is</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">approxfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">wl</span>, <span class="va">new.wl</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approx</a></span><span class="op">(</span><span class="va">wl</span>, <span class="va">y</span>, <span class="va">new.wl</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"constant"</span>,</span>
<span>    ties <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">$</span><span class="va">y</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>which can be applied to the spectra:</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/apply.html">apply</a></span><span class="op">(</span><span class="va">merged</span>, <span class="fl">1</span>, <span class="va">approxfun</span>,</span>
<span>  wl <span class="op">=</span> <span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">merged</span><span class="op">)</span>,</span>
<span>  new.wl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">merged</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  new.wavelength <span class="op">=</span> <span class="st">"new.wl"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">merged</span><span class="op">$</span><span class="va">.</span></span>
<span><span class="co">#&gt;         x     y region measurement .nx .ny spc.1 spc.2 spc.3 spc.4 spc.5</span></span>
<span><span class="co">#&gt; 1  -11.55 -4.77 matrix           1   1  NA   150   128   143    NA    NA</span></span>
<span><span class="co">#&gt; 2  -10.55 -4.77 matrix           1   2  NA    99    84    54    NA    NA</span></span>
<span><span class="co">#&gt; 3   -9.55 -4.77 matrix           1   3  NA   142   118   125    NA    NA</span></span>
<span><span class="co">#&gt; 4   -8.55 -4.77 matrix           1   4  NA    83   108   126    NA    NA</span></span>
<span><span class="co">#&gt; 5   -7.55 -4.77 matrix           1   5   1    27    19    23    27    31</span></span>
<span><span class="co">#&gt; 6   -6.55 -4.77 matrix           1   6   2    14    18    12    20    17</span></span>
<span><span class="co">#&gt; 7   -5.55 -4.77 matrix           1   7   3    22    24    23    28    31</span></span>
<span><span class="co">#&gt; 8   -4.55 -4.77 matrix           1  NA   4    NA    74    78    86    81</span></span>
<span><span class="co">#&gt; 9   -3.55 -4.77 matrix           1  NA   5    NA     0     0     0     1</span></span>
<span><span class="co">#&gt; 10  -2.55 -4.77 matrix           1  NA   6    NA   122   129   135   119</span></span></code></pre></div>
</div>
<div class="section level3" number="6.4">
<h3 id="sec:merge-df">
<span class="header-section-number">6.4</span> Merging Extra Data to Objects That Do Not (Necessarily) Share the Same Spectra<a class="anchor" aria-label="anchor" href="#sec:merge-df"></a>
</h3>
<p>Assume we obtained duplicate reference measurements for some of the concentrations in <code class="sourceCode r">flu</code>:</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flu.ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">flu</span><span class="op">$</span><span class="va">filename</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  cref     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">flu</span><span class="op">$</span><span class="va">c</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">4</span>, sd <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">flu.ref</span></span>
<span><span class="co">#&gt;           filename     cref</span></span>
<span><span class="co">#&gt; 1 rawdata/flu1.txt 0.044329</span></span>
<span><span class="co">#&gt; 2 rawdata/flu1.txt 0.044622</span></span>
<span><span class="co">#&gt; 3 rawdata/flu2.txt 0.087589</span></span>
<span><span class="co">#&gt; 4 rawdata/flu2.txt 0.119215</span></span></code></pre></div>
<p>This information can be merged into the extra data of <code class="sourceCode r">flu</code> by:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flu.merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge.html">merge</a></span><span class="op">(</span><span class="va">flu</span>, <span class="va">flu.ref</span><span class="op">)</span></span>
<span><span class="va">flu.merged</span><span class="op">$</span><span class="va">..</span></span>
<span><span class="co">#&gt;           filename    c n     cref</span></span>
<span><span class="co">#&gt; 1 rawdata/flu1.txt 0.05 1 0.044329</span></span>
<span><span class="co">#&gt; 2 rawdata/flu1.txt 0.05 1 0.044622</span></span>
<span><span class="co">#&gt; 3 rawdata/flu2.txt 0.10 2 0.087589</span></span>
<span><span class="co">#&gt; 4 rawdata/flu2.txt 0.10 2 0.119215</span></span></code></pre></div>
<p>The usual rules for <code class="sourceCode r"><span class="fu">merge</span>()</code> apply.
E. g., if to preserver all spectra of flu, use <code class="sourceCode r">all.x <span class="ot">=</span> <span class="cn">TRUE</span></code>:</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flu.merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge.html">merge</a></span><span class="op">(</span><span class="va">flu</span>, <span class="va">flu.ref</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">flu.merged</span><span class="op">$</span><span class="va">..</span></span>
<span><span class="co">#&gt;           filename    c n     cref</span></span>
<span><span class="co">#&gt; 1 rawdata/flu1.txt 0.05 1 0.044329</span></span>
<span><span class="co">#&gt; 2 rawdata/flu1.txt 0.05 1 0.044622</span></span>
<span><span class="co">#&gt; 3 rawdata/flu2.txt 0.10 2 0.087589</span></span>
<span><span class="co">#&gt; 4 rawdata/flu2.txt 0.10 2 0.119215</span></span>
<span><span class="co">#&gt; 5 rawdata/flu3.txt 0.15 3       NA</span></span>
<span><span class="co">#&gt; 6 rawdata/flu4.txt 0.20 4       NA</span></span>
<span><span class="co">#&gt; 7 rawdata/flu5.txt 0.25 5       NA</span></span>
<span><span class="co">#&gt; 8 rawdata/flu6.txt 0.30 6       NA</span></span></code></pre></div>
<p>The class of the first object (<code class="sourceCode r">x</code>) determines the resulting class:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu"><a href="../reference/merge.html">merge</a></span><span class="op">(</span><span class="va">flu</span>, <span class="va">flu.ref</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "hyperSpec"</span></span>
<span><span class="co">#&gt; attr(,"package")</span></span>
<span><span class="co">#&gt; [1] "hyperSpec"</span></span></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="fu"><a href="../reference/merge.html">merge</a></span><span class="op">(</span><span class="va">flu.ref</span>, <span class="va">flu</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "data.frame"</span></span></code></pre></div>
</div>
<div class="section level3" number="6.5">
<h3 id="splitting-an-object-and-binding-a-list-of-hyperspec-objects">
<span class="header-section-number">6.5</span> Splitting an Object, and Binding a List of <code>hyperSpec</code> Objects<a class="anchor" aria-label="anchor" href="#splitting-an-object-and-binding-a-list-of-hyperspec-objects"></a>
</h3>
<p>A <code>hyperSpec</code> object may also be split into a list of <code>hyperSpec</code> objects:</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clusters</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/split.html">split</a></span><span class="op">(</span><span class="va">faux_cell</span>, <span class="va">faux_cell</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span>
<span><span class="va">clusters</span></span>
<span><span class="co">#&gt; $matrix</span></span>
<span><span class="co">#&gt; hyperSpec object</span></span>
<span><span class="co">#&gt;    682 spectra</span></span>
<span><span class="co">#&gt;    5 data columns</span></span>
<span><span class="co">#&gt;    300 data points / spectrum</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lacuna</span></span>
<span><span class="co">#&gt; hyperSpec object</span></span>
<span><span class="co">#&gt;    155 spectra</span></span>
<span><span class="co">#&gt;    5 data columns</span></span>
<span><span class="co">#&gt;    300 data points / spectrum</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $cell</span></span>
<span><span class="co">#&gt; hyperSpec object</span></span>
<span><span class="co">#&gt;    38 spectra</span></span>
<span><span class="co">#&gt;    5 data columns</span></span>
<span><span class="co">#&gt;    300 data points / spectrum</span></span></code></pre></div>
<p>Splitting can be reversed by <code class="sourceCode r"><span class="fu">rbind</span>()</code> (see section <a href="#sec:bind">6.1</a>).

Another, similar way to combine a number of <code>hyperSpec</code> objects with different wavelength axes or extra data columns is <code class="sourceCode r"><span class="fu">collapse</span>()</code> (see section <a href="#sec:collapse">6.2</a>).</p>
<p>Both <code class="sourceCode r"><span class="fu">rbind</span>()</code> and <code class="sourceCode r"><span class="fu">collapse</span>()</code> take care that factor levels are expanded as necessary:</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lacunae</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[</span><span class="va">faux_cell</span><span class="op">$</span><span class="va">region</span> <span class="op">==</span> <span class="st">"matrix"</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">$</span><span class="va">region</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/show.html">summary</a></span><span class="op">(</span><span class="va">lacunae</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span>
<span><span class="co">#&gt; matrix </span></span>
<span><span class="co">#&gt;    682</span></span></code></pre></div>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cells</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">[</span><span class="va">faux_cell</span><span class="op">$</span><span class="va">region</span> <span class="op">==</span> <span class="st">"cell"</span> <span class="op">&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">faux_cell</span><span class="op">$</span><span class="va">region</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/show.html">summary</a></span><span class="op">(</span><span class="va">cells</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span>
<span><span class="co">#&gt; cell </span></span>
<span><span class="co">#&gt;   38</span></span></code></pre></div>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/show.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">cells</span>, <span class="va">lacunae</span><span class="op">)</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cell matrix </span></span>
<span><span class="co">#&gt;     38    682</span></span></code></pre></div>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/show.html">summary</a></span><span class="op">(</span><span class="fu"><a href="../reference/collapse.html">collapse</a></span><span class="op">(</span><span class="va">cells</span>, <span class="va">lacunae</span><span class="op">)</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span>
<span><span class="co">#&gt;   cell matrix </span></span>
<span><span class="co">#&gt;     38    682</span></span></code></pre></div>
</div>
<div class="section level3" number="6.6">
<h3 id="factor-columns-in-hyperspec-objects-dropping-factor-levels-that-are-not-needed">
<span class="header-section-number">6.6</span> Factor Columns in <code>hyperSpec</code> Objects: Dropping Factor Levels That Are Not Needed<a class="anchor" aria-label="anchor" href="#factor-columns-in-hyperspec-objects-dropping-factor-levels-that-are-not-needed"></a>
</h3>
<p>For subsections of <code>hyperSpec</code> objects that do not contain all levels of a factor column, <code class="sourceCode r"><span class="fu">droplevels</span>()</code> drops the “unpopulated” levels:</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; matrix lacuna   cell </span></span>
<span><span class="co">#&gt;     50      0      0</span></span></code></pre></div>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">$</span><span class="va">region</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; matrix </span></span>
<span><span class="co">#&gt;     50</span></span></code></pre></div>
</div>
</div>
<div class="section level2" number="7">
<h2 id="plotting-hyperspec">
<span class="header-section-number">7</span> Plotting<a class="anchor" aria-label="anchor" href="#plotting-hyperspec"></a>
</h2>
<p>Package <strong>hyperSpec</strong> offers a variety of possibilities to plot spectra, spectral maps, the spectra matrix, time series, depth profiles, etc.
See the <a href="#list-of-vignettes">plotting</a> vignette.</p>
</div>
<div class="section level2" number="8">
<h2 id="appendices">
<span class="header-section-number">8</span> Appendices<a class="anchor" aria-label="anchor" href="#appendices"></a>
</h2>
<div class="section level3">
<h3 id="package-options">Package Options<a class="anchor" aria-label="anchor" href="#package-options"></a>
</h3>
<!-- ----------------------------------------------------------------------- -->
<table class="table">
<caption>
<strong><span id="tab:options">Table 8.1: </span></strong> Package <strong>hyperSpec</strong>’s options.
Please refer to the documentation of the respective functions for details about the effect of the options.</caption>
<colgroup>
<col width="17%">
<col width="17%">
<col width="46%">
<col width="17%">
</colgroup>
<thead><tr class="header">
<th>name</th>
<th align="center">default value (range)</th>
<th>description</th>
<th>used by</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>debuglevel</code></td>
<td align="center">
<code class="sourceCode r"><span class="dv">0</span></code> (<code class="sourceCode r">1L</code>, <code class="sourceCode r">2L</code>)</td>
<td>Amount of debugging information produced</td>
<td>
<code class="sourceCode r"><span class="fu">identify_spc</span>()</code>, <code class="sourceCode r"><span class="fu">map.identify</span>()</code>, <code class="sourceCode r"><span class="fu">spc_rubberband</span>()</code>,<br> various file import functions.</td>
</tr>
<tr class="even">
<td><code>gc</code></td>
<td align="center"><code class="sourceCode r"><span class="cn">FALSE</span></code></td>
<td>Triggers frequent calling of <code class="sourceCode r"><span class="fu">gc</span>()</code>
</td>
<td>
<code class="sourceCode r"><span class="fu">read.ENVI</span>()</code>, <br><code class="sourceCode r"><span class="fu">new</span>(<span class="st">"hyperSpec"</span>)</code>
</td>
</tr>
<tr class="odd">
<td><code>tolerance</code></td>
<td align="center"><code class="sourceCode r"><span class="fu">sqrt</span>(.Machine<span class="sc">$</span>.double.eps)</code></td>
<td>Tolerance for numerical comparisons</td>
<td>File import functions (removing empty spectra), <code class="sourceCode r"><span class="fu">normalize01</span>()</code>
</td>
</tr>
<tr class="even">
<td><code>wl.tolerance</code></td>
<td align="center"><code class="sourceCode r"><span class="fu">sqrt</span>(.Machine<span class="sc">$</span>.double.eps)</code></td>
<td>Tolerance for comparisons of the wavelength axis</td>
<td>
<code class="sourceCode r"><span class="fu">rbind</span>()</code>, <code class="sourceCode r"><span class="fu">rbind2</span>()</code>, <code class="sourceCode r"><span class="fu">bind</span>(<span class="st">"r"</span>, ...)</code>, <code class="sourceCode r"><span class="fu">all.equal</span>()</code>, <code class="sourceCode r"><span class="fu">collapse</span>()</code>
</td>
</tr>
<tr class="odd">
<td><code>file.remove.emptyspc</code></td>
<td align="center"><code class="sourceCode r"><span class="cn">TRUE</span></code></td>
<td>Automatic removing of empty spectra</td>
<td>File import functions, see <a href="#list-of-vignettes">fileio</a>
</td>
</tr>
<tr class="even">
<td><code>file.keep.name</code></td>
<td align="center"><code class="sourceCode r"><span class="cn">TRUE</span></code></td>
<td>Automatic recording of file name in column <code class="sourceCode r">filename</code>
</td>
<td>File import functions, see <a href="#list-of-vignettes">fileio</a>
</td>
</tr>
<tr class="odd">
<td><code>plot.spc.nmax</code></td>
<td align="center"><code class="sourceCode r"><span class="dv">25</span></code></td>
<td>Number of spectra to be plotted by default</td>
<td><code class="sourceCode r"><span class="fu">plot_spc</span>()</code></td>
</tr>
<tr class="even">
<td><code>ggplot.spc.nmax</code></td>
<td align="center"><code class="sourceCode r"><span class="dv">10</span></code></td>
<td></td>
<td><code class="sourceCode r"><span class="fu">qplotspc</span>()</code></td>
</tr>
</tbody>
</table>
<!-- ----------------------------------------------------------------------- -->
</div>
<div class="section level3">
<h3 id="sec:speed-considerations">Speed and Memory Considerations<a class="anchor" aria-label="anchor" href="#sec:speed-considerations"></a>
</h3>
<p>While most of package <strong>hyperSpec</strong>’s functions work at a decent speed for interactive sessions (of course depending on the size of the object), iterated (repeated) calculations as for bootstrapping or iterated cross validation may ask for special speed considerations.</p>
<p>As an example, consider the code for shifting the spectra:</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span></span>
<span><span class="va">shifts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">interpolate</span><span class="op">(</span><span class="va">tmp</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">shifts</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, wl <span class="op">=</span> <span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.053   0.000   0.053</span></span></code></pre></div>
<p>Calculations that involve a lot of subsetting (i.e., extracting or changing the spectra matrix or extra data) can be sped up considerably if the required parts of the <code>hyperSpec</code> object are extracted beforehand.
This is somewhat similar to model fitting in <code>R</code> in general: many model fitting functions in <code>R</code> are much faster if the formula interface is avoided and the appropriate <code class="sourceCode r">data.frame</code>s or matrices are handed over directly.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="va">faux_cell</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">tmp.matrix</span> <span class="op">&lt;-</span> <span class="va">tmp</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">wl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wl.html">wl</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">tmp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">tmp.matrix</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">interpolate</span><span class="op">(</span><span class="va">tmp.matrix</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>, <span class="va">shifts</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, wl <span class="op">=</span> <span class="va">wl</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">tmp</span><span class="op">[[</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">tmp.matrix</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.023   0.000   0.022</span></span></code></pre></div>
</div>
<div class="section level3" number="8.1">
<h3 id="additional-packages">
<span class="header-section-number">8.1</span> Additional Packages<a class="anchor" aria-label="anchor" href="#additional-packages"></a>
</h3>
<p>Package <strong>matrixStats</strong><span class="citation">[<a href="#ref-R-matrixStats" role="doc-biblioref">6</a>]</span> implements fast functions to calculate summary statistics for each row or each column of a matrix.</p>
</div>
<div class="section level3" number="8.2">
<h3 id="memory-usage">
<span class="header-section-number">8.2</span> Memory Usage<a class="anchor" aria-label="anchor" href="#memory-usage"></a>
</h3>
<p>In general, it is not recommended to work with variables that are more than approximately a third of the available RAM in size.
Particularly the import of raw spectroscopic data can consume large amounts of memory.
At certain points, package <strong>hyperSpec</strong> provides switches that allow working with data sets that are actually close to this memory limit.</p>
<p>
The initialization method <code class="sourceCode r"><span class="fu">new</span>(<span class="st">"hyperSpec"</span>, ...)</code> takes particular care to avoid unneccessary copies of the spectra matrix.
In addition, frequent calls to <code class="sourceCode r"><span class="fu">gc</span>()</code> can be requested by <code class="sourceCode r"><span class="fu">hy_set_option</span>(<span class="at">gc =</span> <span class="cn">TRUE</span>)</code>.
The same behaviour is triggered in <code class="sourceCode r"><span class="fu">read.ENVI</span>()</code> and its derivatives (<code>read.ENVI.</code><em><code>Manufacturer</code></em><code class="sourceCode r">()</code>).
The memory consumption of <code class="sourceCode r"><span class="fu">read.txt.Renishaw</span>()</code> can be lowered by importing the data in chunks (argument <code class="sourceCode r">nlines</code>).</p>
</div>
<div class="section level3">
<h3 id="session-info">Session Info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h3>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="st">"hyperSpec"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-weight: bold;">─ Session info ───────────────────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt;  <span style="color: #555555; font-style: italic;">setting </span> <span style="color: #555555; font-style: italic;">value</span></span></span>
<span><span class="co">#&gt;  version  R version 4.2.1 (2022-06-23)</span></span>
<span><span class="co">#&gt;  os       Ubuntu 20.04.4 LTS</span></span>
<span><span class="co">#&gt;  system   x86_64, linux-gnu</span></span>
<span><span class="co">#&gt;  ui       X11</span></span>
<span><span class="co">#&gt;  language en</span></span>
<span><span class="co">#&gt;  collate  C.UTF-8</span></span>
<span><span class="co">#&gt;  ctype    C.UTF-8</span></span>
<span><span class="co">#&gt;  tz       UTC</span></span>
<span><span class="co">#&gt;  date     2022-08-06</span></span>
<span><span class="co">#&gt;  pandoc   2.14.2 @ /usr/bin/ (via rmarkdown)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-weight: bold;">─ Packages ───────────────────────────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt;  <span style="color: #555555; font-style: italic;">package       </span> <span style="color: #555555; font-style: italic;">*</span> <span style="color: #555555; font-style: italic;">version     </span> <span style="color: #555555; font-style: italic;">date (UTC)</span> <span style="color: #555555; font-style: italic;">lib</span> <span style="color: #555555; font-style: italic;">source</span></span></span>
<span><span class="co">#&gt;  brio             1.1.3        <span style="color: #555555;">2021-11-30</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  callr            3.7.1        <span style="color: #555555;">2022-07-13</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  cli              3.3.0        <span style="color: #555555;">2022-04-25</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  colorspace     * 2.0-3        <span style="color: #555555;">2022-02-21</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  crayon           1.5.1        <span style="color: #555555;">2022-03-26</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  deldir           1.0-6        <span style="color: #555555;">2021-10-23</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  desc             1.4.1        <span style="color: #555555;">2022-03-06</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  diffobj          0.3.5        <span style="color: #555555;">2021-10-05</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  digest           0.6.29       <span style="color: #555555;">2021-12-01</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  dplyr            1.0.9        <span style="color: #555555;">2022-04-28</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  ellipsis         0.3.2        <span style="color: #555555;">2021-04-29</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  evaluate         0.15         <span style="color: #555555;">2022-02-18</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  fansi            1.0.3        <span style="color: #555555;">2022-03-24</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  farver           2.1.1        <span style="color: #555555;">2022-07-06</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  fs               1.5.2        <span style="color: #555555;">2021-12-08</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  generics         0.1.3        <span style="color: #555555;">2022-07-05</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  ggplot2        * 3.3.6        <span style="color: #555555;">2022-05-03</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  glue             1.6.2        <span style="color: #555555;">2022-02-24</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  gtable           0.3.0        <span style="color: #555555;">2019-03-25</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  hyperSpec      * <span style="color: #BB00BB; font-weight: bold;">0.200.0.9000</span> <span style="color: #555555;">2022-08-06</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">local</span></span></span>
<span><span class="co">#&gt;  hySpc.testthat   0.2.1        <span style="color: #555555;">2020-06-24</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  interp           1.1-3        <span style="color: #555555;">2022-07-13</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  isoband          0.2.5        <span style="color: #555555;">2021-07-13</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  jpeg             0.1-9        <span style="color: #555555;">2021-07-24</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  jsonlite         1.8.0        <span style="color: #555555;">2022-02-22</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  labeling         0.4.2        <span style="color: #555555;">2020-10-20</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  lattice        * 0.20-45      <span style="color: #555555;">2021-09-22</span> <span style="color: #555555;">[3]</span> <span style="color: #555555;">CRAN (R 4.2.1)</span></span></span>
<span><span class="co">#&gt;  latticeExtra     0.6-30       <span style="color: #555555;">2022-07-04</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  lazyeval         0.2.2        <span style="color: #555555;">2019-03-15</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  lifecycle        1.0.1        <span style="color: #555555;">2021-09-24</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  magrittr         2.0.3        <span style="color: #555555;">2022-03-30</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  MASS             7.3-57       <span style="color: #555555;">2022-04-22</span> <span style="color: #555555;">[3]</span> <span style="color: #555555;">CRAN (R 4.2.1)</span></span></span>
<span><span class="co">#&gt;  Matrix           1.4-1        <span style="color: #555555;">2022-03-23</span> <span style="color: #555555;">[3]</span> <span style="color: #555555;">CRAN (R 4.2.1)</span></span></span>
<span><span class="co">#&gt;  mgcv             1.8-40       <span style="color: #555555;">2022-03-29</span> <span style="color: #555555;">[3]</span> <span style="color: #555555;">CRAN (R 4.2.1)</span></span></span>
<span><span class="co">#&gt;  munsell          0.5.0        <span style="color: #555555;">2018-06-12</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  nlme             3.1-157      <span style="color: #555555;">2022-03-25</span> <span style="color: #555555;">[3]</span> <span style="color: #555555;">CRAN (R 4.2.1)</span></span></span>
<span><span class="co">#&gt;  pillar           1.8.0        <span style="color: #555555;">2022-07-18</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  pkgconfig        2.0.3        <span style="color: #555555;">2019-09-22</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  pkgload          1.3.0        <span style="color: #555555;">2022-06-27</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  png              0.1-7        <span style="color: #555555;">2013-12-03</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  praise           1.0.0        <span style="color: #555555;">2015-08-11</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  processx         3.7.0        <span style="color: #555555;">2022-07-07</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  ps               1.7.1        <span style="color: #555555;">2022-06-18</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  purrr            0.3.4        <span style="color: #555555;">2020-04-17</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  R6               2.5.1        <span style="color: #555555;">2021-08-19</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  RColorBrewer     1.1-3        <span style="color: #555555;">2022-04-03</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  Rcpp             1.0.9        <span style="color: #555555;">2022-07-08</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  RcppEigen        0.3.3.9.2    <span style="color: #555555;">2022-04-08</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  rematch2         2.1.2        <span style="color: #555555;">2020-05-01</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  rlang            1.0.4        <span style="color: #555555;">2022-07-12</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  rprojroot        2.0.3        <span style="color: #555555;">2022-04-02</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  scales           1.2.0        <span style="color: #555555;">2022-04-13</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  testthat         3.1.4        <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  tibble           3.1.8        <span style="color: #555555;">2022-07-22</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  tidyselect       1.1.2        <span style="color: #555555;">2022-02-21</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  utf8             1.2.2        <span style="color: #555555;">2021-07-24</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  vctrs            0.4.1        <span style="color: #555555;">2022-04-13</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  viridisLite      0.4.0        <span style="color: #555555;">2021-04-13</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  waldo            0.4.0        <span style="color: #555555;">2022-03-16</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  withr            2.5.0        <span style="color: #555555;">2022-03-03</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt;  xml2             1.3.3        <span style="color: #555555;">2021-11-30</span> <span style="color: #555555;">[2]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [1] /tmp/RtmprRz461/temp_libpath353327748a24</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [2] /home/runner/work/_temp/Library</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;"> [3] /opt/R/4.2.1/lib/R/library</span></span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB; font-weight: bold;">──────────────────────────────────────────────────────────────────────────────────────────────────</span></span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body">
<div id="ref-R-mvtnorm" class="csl-entry">
<div class="csl-left-margin">[1] </div>
<div class="csl-right-inline">A. Genz, F. Bretz, T. Miwa, X. Mi, T. Hothorn, Mvtnorm: Multivariate normal and t distributions, 2021. <a href="http://mvtnorm.R-forge.R-project.org" class="external-link">http://mvtnorm.R-forge.R-project.org</a>.</div>
</div>
<div id="ref-mvtnorm2009" class="csl-entry">
<div class="csl-left-margin">[2] </div>
<div class="csl-right-inline">A. Genz, F. Bretz, Computation of multivariate normal and t probabilities, Springer-Verlag, Heidelberg, 2009.</div>
</div>
<div id="ref-R-baseline" class="csl-entry">
<div class="csl-left-margin">[3] </div>
<div class="csl-right-inline">K.H. Liland, B.-H. Mevik, Baseline: Baseline correction of spectra, 2022. <a href="https://github.com/khliland/baseline/" class="external-link">https://github.com/khliland/baseline/</a>.</div>
</div>
<div id="ref-baseline2010" class="csl-entry">
<div class="csl-left-margin">[4] </div>
<div class="csl-right-inline">K.H. Liland, T. Almøy, B.-H. Mevik, Optimal choice of baseline correction for multivariate calibration of spectra, Applied Spectroscopy. 64 (2010) 1007–1016.</div>
</div>
<div id="ref-R-pls" class="csl-entry">
<div class="csl-left-margin">[5] </div>
<div class="csl-right-inline">K.H. Liland, B.-H. Mevik, R. Wehrens, Pls: Partial least squares and principal component regression, 2022. <a href="https://github.com/khliland/pls" class="external-link">https://github.com/khliland/pls</a>.</div>
</div>
<div id="ref-R-matrixStats" class="csl-entry">
<div class="csl-left-margin">[6] </div>
<div class="csl-right-inline">H. Bengtsson, matrixStats: Functions that apply to rows and columns of matrices (and to vectors), 2022. <a href="https://github.com/HenrikBengtsson/matrixStats" class="external-link">https://github.com/HenrikBengtsson/matrixStats</a>.</div>
</div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Formulas are combined to a list by <code class="sourceCode r"><span class="fu">c</span>()</code>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Function <code class="sourceCode r"><span class="fu">sweep</span>()</code> cannot be used here, and while there is the possibility to use <code class="sourceCode r"><span class="fu">sapply</span>()</code> or <code class="sourceCode r"><span class="fu">mapply</span>()</code>, they are not faster than the for loop in this case.
Make sure to work on a copy of the spectra matrix, as that is much faster than row-wise extracting and changing the spectra by <code class="sourceCode r">[[</code> and <code class="sourceCode r">[[<span class="ot">&lt;-</span></code>.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Claudia Beleites, <a href="https://orcid.org/0000-0002-9500-5167" class="external-link">Vilmantas Gegzna</a>, <a href="http://academic.depauw.edu/hanson_web/" class="external-link">Bryan A. Hanson</a>, Roman Kiselev, Erick Oduniyi, Valter Sergo.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
